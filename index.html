<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WealthVerse | Interface X</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-glass: rgba(15, 23, 42, 0.9);
            --border-glass: rgba(255, 255, 255, 0.1);
            --primary: #6366f1;
            --accent: #f43f5e;
            --success: #10b981;
            --gold: #f59e0b;
            --neon-blue: #00f3ff;
            --neon-pink: #d946ef;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-dark);
            color: var(--text-main); 
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            padding-bottom: 3rem;
            overflow-x: hidden;
            transition: background 0.5s ease;
        }

        /* BACKGROUND MODES */
        body.mode-default { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        body.mode-trader { background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%); }
        body.mode-run { background: linear-gradient(to bottom, #2e1065 0%, #0f172a 100%); }
        body.mode-kids { background: linear-gradient(120deg, #0ea5e9 0%, #8b5cf6 100%); }

        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }

        /* HEADER */
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 1.5rem 0; margin-bottom: 1.5rem;
        }
        .brand { font-family: 'Space Grotesk', sans-serif; font-size: 1.8rem; font-weight: 700; background: linear-gradient(to right, #6366f1, #00f3ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: flex; align-items: center; gap: 10px; }

        /* --- NEW DROPDOWN NAVIGATION SYSTEM --- */
        .nav-dock {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px;
            margin-bottom: 2rem; position: relative; z-index: 100;
        }

        .dropdown-container { position: relative; }

        /* The Main Category Button */
        .drop-trigger {
            width: 100%; padding: 12px;
            background: rgba(255,255,255,0.05);
            border: 1px solid var(--border-glass);
            border-radius: 12px; color: var(--text-sub);
            font-weight: 700; font-size: 0.9rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px;
            transition: all 0.3s;
        }
        .drop-trigger:hover { background: rgba(255,255,255,0.1); color: white; }
        .drop-trigger i.caret { font-size: 0.7rem; transition: transform 0.3s; }
        
        /* Active State (Category Selected) */
        .drop-trigger.active-category {
            background: var(--primary); color: white;
            box-shadow: 0 0 15px rgba(99, 102, 241, 0.4);
            border-color: var(--primary);
        }
        .drop-trigger.open i.caret { transform: rotate(180deg); }

        /* The Dropdown Menu */
        .drop-menu {
            position: absolute; top: 110%; left: 0; width: 100%; min-width: 200px;
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--border-glass);
            border-radius: 16px; padding: 8px;
            display: none; flex-direction: column; gap: 5px;
            box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5);
            animation: dropIn 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes dropIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .dropdown-container:last-child .drop-menu { right: 0; left: auto; } /* Align last menu to right */

        /* Menu Items */
        .menu-btn {
            background: transparent; border: none; padding: 12px;
            color: var(--text-sub); text-align: left;
            font-size: 0.95rem; font-weight: 600; cursor: pointer;
            border-radius: 8px; display: flex; align-items: center; gap: 10px;
            transition: 0.2s;
        }
        .menu-btn:hover { background: rgba(255,255,255,0.05); color: white; padding-left: 15px; }
        .menu-btn.active { background: rgba(99, 102, 241, 0.1); color: var(--primary); }
        .menu-btn i { font-size: 1.1rem; }

        /* Show Class */
        .show-menu { display: flex; }


        /* LAYOUTS */
        .dashboard, .game-layout, .kid-layout { display: none; animation: slideUp 0.3s ease-out; }
        .dashboard { grid-template-columns: 1fr 1.5fr; gap: 1.5rem; }
        .game-layout { grid-template-columns: 1fr 350px; gap: 1.5rem; }
        .kid-layout { grid-template-columns: 1fr; gap: 1.5rem; max-width: 800px; margin: 0 auto; }
        .dashboard.active, .game-layout.active, .kid-layout.active { display: grid; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* UI */
        .glass-card { background: var(--card-glass); backdrop-filter: blur(20px); border: 1px solid var(--border-glass); border-radius: 20px; padding: 2rem; position: relative; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        .input-wrap { margin-bottom: 1.5rem; }
        .input-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; font-size: 0.9rem; color: var(--text-sub); }
        .input-val { font-weight: 700; color: var(--primary); }
        input[type=range] { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; -webkit-appearance: none; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #fff; margin-top: -6px; }
        .big-value { font-size: 3rem; font-weight: 800; background: linear-gradient(to right, #fff, #cbd5e1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .chart-main { height: 280px; width: 100%; }
        
        .reset-btn { background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); color: #fca5a5; padding: 5px 12px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; }
        .kid-btn { padding: 15px; border-radius: 12px; border: none; font-size: 1.1rem; font-weight: 800; cursor: pointer; width: 48%; transition: transform 0.1s; }
        .kid-btn:active { transform: scale(0.95); }
        .btn-need { background: var(--success); color: white; box-shadow: 0 4px 0 #065f46; }
        .btn-want { background: var(--accent); color: white; box-shadow: 0 4px 0 #9f1239; }

        .game-screen { background: #000; height: 400px; border-radius: 16px; position: relative; border: 1px solid #333; overflow: hidden; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        .game-over-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 20; display:none; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; }

        /* --- DEFENSE GAME --- */
        .defense-card { text-align: center; padding: 20px; border: 1px solid rgba(255,255,255,0.1); border-radius: 12px; background: rgba(255,255,255,0.05); margin-top: 10px; }
        .news-ticker { background: #000; color: var(--gold); padding: 5px 10px; font-family: monospace; border-radius: 4px; margin-bottom: 10px; display: inline-block; }

        /* --- WEALTH RUN --- */
        #run_game_container { width: 100%; height: 100%; position: relative; background: linear-gradient(to bottom, #1e1b4b 0%, #4c1d95 50%, #db2777 100%); perspective: 600px; overflow: hidden; }
        #run_game_container::after { content:''; position: absolute; bottom:0; left:0; width:100%; height:50%; background: linear-gradient(90deg, transparent 95%, rgba(0,243,255,0.2) 95%); background-size: 40px 40px; transform: perspective(500px) rotateX(60deg); pointer-events: none; }
        .road { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%) rotateX(60deg); width: 340px; height: 120%; background: #0f172a; border-left: 8px solid var(--neon-blue); border-right: 8px solid var(--neon-blue); box-shadow: 0 0 40px rgba(0, 243, 255, 0.3); }
        .lane-marker { position: absolute; top: 0; left: 33%; width: 4px; height: 100%; background: repeating-linear-gradient(to bottom, rgba(255,255,255,0.5) 0%, rgba(255,255,255,0.5) 50%, transparent 50%, transparent 100%); background-size: 10px 40px; animation: moveRoad 0.2s linear infinite; }
        .lane-marker.right { left: 66%; }
        @keyframes moveRoad { from { background-position: 0 0; } to { background-position: 0 40px; } }
        .player-ball { 
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); 
            font-size: 3.5rem; line-height: 1; z-index: 10; 
            transition: left 0.08s cubic-bezier(0, 0, 0.2, 1), transform 0.1s; 
            filter: drop-shadow(0 10px 10px rgba(0,0,0,0.6));
        }
        .player-ball.lean-left { transform: translateX(-50%) rotate(-15deg); }
        .player-ball.lean-right { transform: translateX(-50%) rotate(15deg); }
        .obstacle, .coin { position: absolute; transform: translateX(-50%); display: flex; justify-content: center; align-items: center; z-index: 5; }
        .obstacle { background: #111; border: 2px solid #ef4444; border-radius: 50%; width: 100%; height: 20px; box-shadow: inset 0 0 10px #000; }
        .coin { font-size: 0px; background: radial-gradient(circle, #fbbf24, #d97706); border: 2px solid #fff; border-radius: 50%; box-shadow: 0 0 15px #fbbf24; }
        .control-pad { display: flex; gap: 30px; margin-top: 15px; width: 100%; justify-content: center; }
        .control-btn { width: 70px; height: 70px; border-radius: 50%; background: rgba(255,255,255,0.1); color: white; font-size: 2rem; cursor: pointer; border: 1px solid rgba(255,255,255,0.3); transition: transform 0.05s; display:flex; align-items:center; justify-content:center;}
        .control-btn:active { background: var(--primary); transform: scale(0.9); }

        /* --- PIGGY DASH UPDATED --- */
        #piggy_container { 
            width: 100%; height: 450px; 
            position: relative; background: #1e293b; overflow: hidden; 
            border: 3px solid var(--neon-pink); border-radius: 16px;
        }
        .piggy { 
            position: absolute; bottom: 20px; width: 80px; height: 80px; 
            background: #ec4899; border-radius: 50%; 
            display: flex; align-items: center; justify-content: center; font-size: 3rem;
            box-shadow: 0 0 30px rgba(236, 72, 153, 0.6); transition: left 0.1s;
            border: 3px solid white; z-index: 10;
        }
        .drop-item { 
            position: absolute; font-size: 3rem; 
            transition: top 0.05s linear; 
            filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5));
        }

        @media (max-width: 900px) { 
            .dashboard, .game-layout { grid-template-columns: 1fr; }
            .nav-dock { gap: 5px; }
            .drop-trigger { font-size: 0.8rem; padding: 10px; }
        }
    </style>
</head>
<body class="mode-default">

<div class="container">
    <header>
        <div class="brand"><i class="ph-fill ph-currency-inr"></i> WealthVerse <span style="font-weight:300; color:white;">Arcade</span></div>
    </header>

    <nav class="nav-dock">
        
        <div class="dropdown-container">
            <button class="drop-trigger active-category" onclick="toggleDrop('menu-tools', this)">
                <i class="ph-fill ph-wrench"></i> Tools <i class="ph-bold ph-caret-down caret"></i>
            </button>
            <div id="menu-tools" class="drop-menu">
                <button class="menu-btn active" onclick="setTab('sip', this, 'tools')"><i class="ph-bold ph-trend-up"></i> SIP Calculator</button>
                <button class="menu-btn" onclick="setTab('emi', this, 'tools')"><i class="ph-bold ph-house"></i> EMI Calculator</button>
                <button class="menu-btn" onclick="setTab('arb', this, 'tools')"><i class="ph-bold ph-scales"></i> Arbitrage</button>
            </div>
        </div>

        <div class="dropdown-container">
            <button class="drop-trigger" onclick="toggleDrop('menu-arcade', this)">
                <i class="ph-fill ph-game-controller"></i> Arcade <i class="ph-bold ph-caret-down caret"></i>
            </button>
            <div id="menu-arcade" class="drop-menu">
                <button class="menu-btn" onclick="setTab('game1', this, 'arcade')"><i class="ph-fill ph-chart-candlestick"></i> Trader Pro</button>
                <button class="menu-btn" onclick="setTab('game2', this, 'arcade')"><i class="ph-fill ph-shield-check"></i> Defense</button>
                <button class="menu-btn" onclick="setTab('game3', this, 'arcade')"><i class="ph-fill ph-person-simple-run"></i> Wealth Run 3D</button>
            </div>
        </div>

        <div class="dropdown-container">
            <button class="drop-trigger" onclick="toggleDrop('menu-kids', this)">
                <i class="ph-fill ph-baby"></i> Kids <i class="ph-bold ph-caret-down caret"></i>
            </button>
            <div id="menu-kids" class="drop-menu">
                <button class="menu-btn" onclick="setTab('kid1', this, 'kids')"><i class="ph-fill ph-coins"></i> Coin Quest</button>
                <button class="menu-btn" onclick="setTab('kid2', this, 'kids')"><i class="ph-fill ph-piggy-bank"></i> Piggy Dash</button>
            </div>
        </div>

    </nav>

    <div id="sip" class="dashboard active"><div class="glass-card"><h3><i class="ph ph-sliders"></i> SIP</h3><div class="input-wrap"><div class="input-header"><label>Monthly</label><span class="input-val" id="sip_amt_val">‚Çπ 25 K</span></div><input type="range" id="sip_amt" min="1000" max="200000" step="500" value="25000"></div><div class="input-wrap"><div class="input-header"><label>Years</label><span class="input-val" id="sip_years_val">10 Yrs</span></div><input type="range" id="sip_years" min="1" max="40" step="1" value="10"></div><div class="input-wrap"><div class="input-header"><label>Return</label><span class="input-val" id="sip_rate_val">12 %</span></div><input type="range" id="sip_rate" min="5" max="30" step="0.5" value="12"></div></div><div class="glass-card"><div class="big-number-block"><div class="big-label">Value</div><div class="big-value" id="sip_final">‚Çπ 0</div></div><div class="chart-main"><canvas id="sipLineChart"></canvas></div></div></div>
    <div id="emi" class="dashboard"><div class="glass-card"><h3>EMI</h3><div class="input-wrap"><div class="input-header"><label>Loan</label><span class="input-val" id="emi_amt_val">‚Çπ 50 L</span></div><input type="range" id="emi_amt" min="500000" max="10000000" step="100000" value="5000000"></div><div class="input-wrap"><div class="input-header"><label>Years</label><span class="input-val" id="emi_years_val">20 Yrs</span></div><input type="range" id="emi_years" min="1" max="30" step="1" value="20"></div><div class="input-wrap"><div class="input-header"><label>Rate</label><span class="input-val" id="emi_rate_val">8.5 %</span></div><input type="range" id="emi_rate" min="6" max="15" step="0.1" value="8.5"></div></div><div class="glass-card"><div class="big-number-block"><div class="big-label">EMI</div><div class="big-value" id="emi_monthly">‚Çπ 0</div></div><div class="chart-main"><canvas id="emiChart"></canvas></div></div></div>
    <div id="arb" class="dashboard"><div class="glass-card"><h3>Arbitrage</h3><div class="input-wrap"><div class="input-header"><label>Loan</label><span class="input-val" id="arb_amt_val">‚Çπ 50 L</span></div><input type="range" id="arb_amt" min="500000" max="10000000" step="100000" value="5000000"></div><div class="input-wrap"><div class="input-header"><label>Rate</label><span class="input-val" id="arb_loan_rate_val">8 %</span></div><input type="range" id="arb_loan_rate" min="1" max="15" step="0.1" value="8"></div><div class="input-wrap"><div class="input-header"><label>Return</label><span class="input-val" id="arb_inv_rate_val">12 %</span></div><input type="range" id="arb_inv_rate" min="1" max="20" step="0.1" value="12"></div></div><div class="glass-card"><div class="big-number-block"><div class="big-label">Profit</div><div class="big-value" id="arb_net">‚Çπ 0</div><div id="arb_status" style="font-weight:700;"></div></div><div class="chart-main"><canvas id="arbChart"></canvas></div></div></div>

    <div id="game1" class="game-layout">
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <h3>Live Market</h3>
                <button class="reset-btn" onclick="resetMM()">Restart</button>
            </div>
            <div class="game-screen">
                <div class="candle-timer" id="candle_timer">New Candle: 5s</div>
                <div style="position:absolute; top:10px; left:10px; z-index:10; color:var(--success); font-family:monospace; font-size:1.2rem;">NIFTY: <span id="mm_price">20000</span></div>
                <div class="pattern-badge" id="mm_pattern_name">Scanning...</div>
                <canvas id="mmChart"></canvas>
            </div>
            <div style="margin-top:10px; display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                <button class="kid-btn btn-need" style="width:100%" onclick="mmTrade('buy')">BUY</button>
                <button class="kid-btn btn-want" style="width:100%" onclick="mmTrade('sell')">SELL</button>
            </div>
        </div>
        <div class="glass-card">
            <h4>Portfolio</h4>
            <div class="big-value" id="mm_equity" style="font-size:2rem;">‚Çπ 10.00 L</div>
            <div style="margin-top:1rem; color:var(--text-sub);">Cash: <span id="mm_cash">‚Çπ 10.00 L</span></div>
            <div style="margin-top:0.5rem; color:var(--text-sub);">Stocks: <span id="mm_stocks">0</span></div>
        </div>
    </div>

    <div id="game2" class="game-layout">
        <div class="glass-card">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3>Defense Strategy</h3>
                <button class="reset-btn" onclick="resetPD()">Restart</button>
            </div>
            <div class="defense-card">
                <h2 id="pd_year" style="color:var(--primary)">Year 1</h2>
                <div class="news-ticker">üì∞ NEWS FLASH</div>
                <h3 id="pd_event_title" style="margin-bottom:10px; font-weight:800;">Market is Stable</h3>
                <p id="pd_event_desc" style="color:var(--text-sub); margin-bottom:20px; font-size:0.9rem;">Analysts predict steady growth. Inflation is under control.</p>
                <div id="pd_buttons" style="display:flex; gap:10px; justify-content:center;">
                    <button class="kid-btn btn-need" onclick="pdResolve('invest')">Invest</button>
                    <button class="kid-btn btn-want" onclick="pdResolve('hold')">Hold</button>
                </div>
            </div>
        </div>
        <div class="glass-card">
             <h4>Net Worth</h4>
             <div class="big-value" id="pd_networth">‚Çπ 10.0 L</div>
             <div id="pd_feedback" style="margin-top:1rem; font-weight:bold; color:var(--gold);"></div>
        </div>
    </div>

    <div id="game3" class="kid-layout">
        <div class="glass-card" style="border-color: var(--neon-blue);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h3 style="color:var(--neon-blue)">Wealth Run 3D</h3>
                <div style="font-size:1.2rem; font-weight:800; color:var(--gold);">Score: <span id="run_score">0</span></div>
            </div>
            
            <div class="game-screen" style="height:350px; margin-top:15px; border:2px solid #334155;">
                <div id="run_game_container">
                    <div class="road"><div class="lane-marker"></div><div class="lane-marker right"></div></div>
                    <div id="run_player" class="player-ball">üèéÔ∏è</div>
                    <div id="run_game_over" class="game-over-overlay"><h2 style="font-size:2.5rem; color:var(--accent);">CRASHED!</h2><button class="kid-btn btn-need" onclick="startRunGame()">Try Again</button></div>
                    <div id="run_start_overlay" class="game-over-overlay" style="display:flex; background:rgba(0,0,0,0.6);"><h2>Ready?</h2><p>Dodge Potholes | Grab Coins</p><button class="kid-btn btn-need" onclick="startRunGame()">Start</button></div>
                </div>
            </div>
            <div class="control-pad">
                <button class="control-btn" onclick="moveRun('left')"><i class="ph-bold ph-arrow-left"></i></button>
                <button class="control-btn" style="background:var(--gold);color:black;" onclick="moveRun('jump')">UP</button>
                <button class="control-btn" onclick="moveRun('right')"><i class="ph-bold ph-arrow-right"></i></button>
            </div>
        </div>
    </div>

    <div id="kid1" class="kid-layout">
        <div class="glass-card" style="border-color: var(--kid-blue); background: rgba(14, 165, 233, 0.1);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="color:var(--kid-blue)">ü™ô Coin Quest</h2>
                <button class="reset-btn" onclick="resetKQ()">Reset</button>
            </div>
            
            <div id="kq_game_area" style="text-align:center;">
                <div style="font-size:1.2rem; font-weight:800; margin:10px 0; color:var(--gold);">Score: <span id="kq_score">0</span> / 15</div>
                <div style="font-size:5rem; margin:20px 0; animation:bounce 2s infinite;" id="kq_icon">üçé</div>
                <h3 id="kq_item" style="font-size:2rem; margin-bottom:20px;">Apple</h3>
                <div style="display:flex; justify-content:center; gap:20px;">
                    <button class="kid-btn btn-need" onclick="checkKQ('need')">NEED ‚úÖ</button>
                    <button class="kid-btn btn-want" onclick="checkKQ('want')">WANT üéÅ</button>
                </div>
                <div id="kq_msg" style="margin-top:15px; height:20px; font-weight:bold;"></div>
            </div>

            <div id="kq_result_area" style="display:none; text-align:center; padding:20px;">
                <h2 style="color:var(--gold)">Report Card üéì</h2>
                <div style="font-size:4rem; margin:10px;">‚≠ê</div>
                <h3 id="kq_rank">Super Saver!</h3>
                <p id="kq_final_score" style="margin-bottom:20px;"></p>
                <button class="kid-btn btn-need" onclick="resetKQ()">Play Again</button>
            </div>
        </div>
    </div>

    <div id="kid2" class="kid-layout">
        <div class="glass-card" style="border-color: var(--neon-pink); background: rgba(236, 72, 153, 0.1);">
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <h2 style="color:var(--neon-pink)">üê∑ Piggy Dash</h2>
                <div style="font-weight:bold; color:var(--gold);">Saved: ‚Çπ <span id="piggy_score">0</span></div>
            </div>
            
            <div class="game-screen" id="piggy_container" style="margin-top:15px; border:2px solid var(--neon-pink);">
                <div id="piggy_player" class="piggy">üê∑</div>
                <div id="piggy_overlay" class="game-over-overlay" style="display:flex;">
                    <h2>Catch Money!</h2>
                    <p style="font-size:1.5rem">üí∞ ü™ô üíµ üíé</p>
                    <p>Avoid: üí£ üî®</p>
                    <button class="kid-btn btn-need" onclick="startPiggy()">Start</button>
                </div>
            </div>
            
            <div class="control-pad">
                <button class="control-btn" onmousedown="movePiggy('left')" onmouseup="stopPiggy()" ontouchstart="movePiggy('left')" ontouchend="stopPiggy()"><i class="ph-bold ph-arrow-left"></i></button>
                <button class="control-btn" onmousedown="movePiggy('right')" onmouseup="stopPiggy()" ontouchstart="movePiggy('right')" ontouchend="stopPiggy()"><i class="ph-bold ph-arrow-right"></i></button>
            </div>
        </div>
    </div>
</div>

<script>
    const formatCurrency = (num) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);

    let charts = {};

    // --- NAVIGATION LOGIC ---
    function toggleDrop(menuId, btn) {
        // Close all others
        document.querySelectorAll('.drop-menu').forEach(m => {
            if(m.id !== menuId) m.classList.remove('show-menu');
        });
        document.querySelectorAll('.drop-trigger').forEach(b => {
            if(b !== btn) b.classList.remove('open');
        });

        // Toggle current
        document.getElementById(menuId).classList.toggle('show-menu');
        btn.classList.toggle('open');
    }

    function setTab(id, btn, category) {
        // Close Menu
        document.querySelectorAll('.drop-menu').forEach(m => m.classList.remove('show-menu'));
        document.querySelectorAll('.drop-trigger').forEach(b => b.classList.remove('open'));

        // Set Active Category Button
        document.querySelectorAll('.drop-trigger').forEach(b => b.classList.remove('active-category'));
        btn.parentElement.parentElement.previousElementSibling.classList.add('active-category');

        // Set Active Content
        document.querySelectorAll('.dashboard, .game-layout, .kid-layout').forEach(e => e.classList.remove('active'));
        document.getElementById(id).classList.add('active');

        // Set Active Menu Item Style
        document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // Mode Logic
        document.body.className = 'mode-default';
        if(category === 'arcade') {
            if(id === 'game1') { document.body.classList.add('mode-trader'); initMM(); }
            if(id === 'game2') { /* Defense */ }
            if(id === 'game3') { document.body.classList.add('mode-run'); }
        }
        else if(category === 'kids') {
            document.body.classList.add('mode-kids');
            if(id === 'kid1') loadKQ();
        }
        else {
            calcAll();
        }

        if(runActive) gameOverRun();
        if(pigActive) { pigActive=false; clearInterval(pigSpawnInt); }
    }

    // --- CALCULATORS ---
    function setupInput(id, type='currency') {
        const el = document.getElementById(id);
        const valEl = document.getElementById(id+'_val');
        const update = () => {
            if(type === 'currency') valEl.innerText = formatCurrency(parseFloat(el.value));
            if(type === 'years') valEl.innerText = el.value + " Yrs";
            if(type === 'percent') valEl.innerText = el.value + " %";
            calcAll();
        };
        el.addEventListener('input', update);
        update();
    }
    function calcAll() {
        const P = parseFloat(document.getElementById('sip_amt').value), N = parseFloat(document.getElementById('sip_years').value), R = parseFloat(document.getElementById('sip_rate').value);
        let val=0, mR=R/1200; for(let i=0; i<N*12; i++) val=(val+P)*(1+mR); let tax=Math.max(0, val-(P*N*12)-125000)*0.125;
        document.getElementById('sip_final').innerText = formatCurrency(val-tax);
        newChart('sipLineChart', 'line', { labels:Array.from({length:N},(_,i)=>i+1), datasets:[{data:Array.from({length:N},(_,i)=>{let v=0;for(let m=0;m<(i+1)*12;m++)v=(v+P)*(1+mR);return v}), borderColor:'#6366f1', backgroundColor:'rgba(99,102,241,0.2)', fill:true}] });

        const L = parseFloat(document.getElementById('emi_amt').value), Y = parseFloat(document.getElementById('emi_years').value)*12, I = parseFloat(document.getElementById('emi_rate').value)/1200;
        const emi = (L*I*Math.pow(1+I,Y))/(Math.pow(1+I,Y)-1);
        document.getElementById('emi_monthly').innerText = formatCurrency(emi);
        newChart('emiChart', 'bar', { labels:['Principal','Interest'], datasets:[{data:[L,(emi*Y)-L], backgroundColor:['#6366f1','#f43f5e']}] }, {indexAxis:'y'});

        const arbA=parseFloat(document.getElementById('arb_amt').value), lR=parseFloat(document.getElementById('arb_loan_rate').value)/100, iR=parseFloat(document.getElementById('arb_inv_rate').value)/100;
        let c=arbA, l=arbA, lbs=[], d1=[], d2=[]; for(let i=1; i<=10; i++){c*=(1+iR); l*=(1+lR); lbs.push(i); d1.push(c); d2.push(l);}
        document.getElementById('arb_net').innerText = formatCurrency(c-l);
        document.getElementById('arb_status').innerText = (c-l)>0 ? "‚úÖ Profitable" : "‚ùå Loss";
        newChart('arbChart', 'line', { labels:lbs, datasets:[{label:'Inv',data:d1,borderColor:'#10b981'}, {label:'Loan',data:d2,borderColor:'#f43f5e',borderDash:[5,5]}] });
    }
    function newChart(id, type, data, opts={}) {
        const ctx = document.getElementById(id).getContext('2d');
        if(charts[id]) charts[id].destroy();
        charts[id] = new Chart(ctx, { type, data, options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{grid:{display:false}}}, ...opts } });
    }

    // --- GAME 1: TRADER ---
    let mmInt, mmP=20000, mmC=1000000, mmS=0, currentCandle={o:0,h:0,l:0,c:0}, candleEndTime=0, targetPrice=20000;
    const MAX_CANDLES = 30;
    const patterns = [{n:"Bull Run üöÄ",target:1.05},{n:"Bear Crash üìâ",target:0.95},{n:"Sideways",target:1.00}];

    function initMM() {
        if(charts['mm']) return;
        const ctx = document.getElementById('mmChart').getContext('2d');
        charts['mm'] = new Chart(ctx, { type: 'bar', data: { labels: Array(MAX_CANDLES).fill(''), datasets: [ { label: 'Wick', data: Array(MAX_CANDLES).fill(null), backgroundColor: '#94a3b8', barThickness: 2, grouped: false }, { label: 'Body', data: Array(MAX_CANDLES).fill(null), backgroundColor: (c) => c.raw && c.raw[1]>=c.raw[0]?'#10b981':'#f43f5e', barThickness: 8, grouped: false } ] }, options: { animation: false, responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { display: false }, y: { position: 'right', grid: { color: '#333' } } } } });
        startNewCandle(); mmInt = setInterval(tickMarket, 100);
    }
    function startNewCandle() {
        let prevClose = currentCandle.c || 20000; currentCandle = { o:prevClose, h:prevClose, l:prevClose, c:prevClose };
        candleEndTime = Date.now() + 5000 + Math.random()*5000;
        if(Math.random()>0.7) { let p=patterns[Math.floor(Math.random()*patterns.length)]; document.getElementById('mm_pattern_name').innerText=p.n; targetPrice=mmP*p.target; }
        let c = charts['mm']; if(c.data.datasets[0].data[MAX_CANDLES-1]!==null) { c.data.datasets[0].data.shift();c.data.datasets[0].data.push(null); c.data.datasets[1].data.shift();c.data.datasets[1].data.push(null); }
    }
    function tickMarket() {
        if(!document.getElementById('game1').classList.contains('active')) return;
        let drift = (targetPrice - mmP) * 0.05; let noise = (Math.random() - 0.5) * 50; mmP += drift + noise;
        currentCandle.c = mmP; if(mmP > currentCandle.h) currentCandle.h = mmP; if(mmP < currentCandle.l) currentCandle.l = mmP;
        document.getElementById('mm_price').innerText = mmP.toFixed(0); updateMM();
        let c = charts['mm']; let idx = MAX_CANDLES - 1; for(let i=0; i<MAX_CANDLES; i++) { if(c.data.datasets[0].data[i] === null) { idx=i; break; } }
        c.data.datasets[0].data[idx] = [currentCandle.l, currentCandle.h]; c.data.datasets[1].data[idx] = [currentCandle.o, currentCandle.c]; c.update('none');
        if(Date.now() >= candleEndTime) startNewCandle();
        let timeLeft = Math.max(0, Math.ceil((candleEndTime - Date.now())/1000)); document.getElementById('candle_timer').innerText = "New: " + timeLeft + "s";
    }
    function updateMM() { document.getElementById('mm_equity').innerText = formatCurrency(mmC + mmS*mmP); document.getElementById('mm_cash').innerText = formatCurrency(mmC); document.getElementById('mm_stocks').innerText = mmS; }
    function mmTrade(t) { if(t==='buy' && mmC>mmP) {mmS++; mmC-=mmP;} if(t==='sell' && mmS>0) {mmS--; mmC+=mmP;} updateMM(); }
    function resetMM() { mmC=1000000; mmS=0; mmP=20000; startNewCandle(); updateMM(); }

    // --- GAME 2: DEFENSE ---
    let pdN=1000000, pdY=1;
    const scenarios = [
        {t:"Tech Boom AI", d:"Tech stocks skyrocket! Safe assets lag.", buy:1.30, hold:1.05},
        {t:"Global Pandemic", d:"Markets crash worldwide. Cash is king.", buy:0.70, hold:0.95},
        {t:"Housing Bubble", d:"Real estate pops. Stocks volatile.", buy:0.90, hold:1.02},
        {t:"War Outbreak", d:"Uncertainty high. Commodities fly.", buy:0.80, hold:1.00},
        {t:"Election Year", d:"Market optimism returns.", buy:1.15, hold:1.06},
        {t:"Crypto Craze", d:"Speculative assets boom.", buy:1.40, hold:1.00},
        {t:"Inflation Hike", d:"Purchasing power drops.", buy:0.95, hold:0.95},
        {t:"Green Energy", d:"Sustainable stocks rally.", buy:1.20, hold:1.04},
        {t:"Cyber Attack", d:"Banking sector hit hard.", buy:0.85, hold:1.00},
        {t:"Tax Cut", d:"Corporate profits soar.", buy:1.10, hold:1.05},
        {t:"Oil Crisis", d:"Energy prices spike.", buy:0.90, hold:0.98},
        {t:"Startups IPO", d:"New unicorns enter market.", buy:1.25, hold:1.03},
        {t:"Trade Deal", d:"Exports increase.", buy:1.12, hold:1.04},
        {t:"Recession", d:"Slow growth everywhere.", buy:0.88, hold:1.01},
        {t:"Gold Rush", d:"Safe havens perform well.", buy:1.05, hold:1.10}
    ];
    let currentScenario = scenarios[0];

    function nextYearScenario() {
        if(pdY > 10) return;
        currentScenario = scenarios[Math.floor(Math.random()*scenarios.length)];
        document.getElementById('pd_event_title').innerText = currentScenario.t;
        document.getElementById('pd_event_desc').innerText = currentScenario.d;
    }

    function pdResolve(choice) {
        if(pdY>10) return;
        let multiplier = choice === 'invest' ? currentScenario.buy : currentScenario.hold;
        multiplier += (Math.random() - 0.5) * 0.1;
        pdN *= multiplier;
        let gain = multiplier >= 1;
        document.getElementById('pd_feedback').innerText = (gain?"+":"") + Math.round((multiplier-1)*100) + "% Return";
        document.getElementById('pd_feedback').style.color = gain ? 'var(--success)' : 'var(--accent)';
        pdY++;
        document.getElementById('pd_networth').innerText = formatCurrency(pdN); 
        document.getElementById('pd_year').innerText = "Year " + pdY;
        if(pdY > 10) {
            document.getElementById('pd_buttons').innerHTML = `<div style='font-size:1.2rem; color:white;'>Game Over! Final: ${formatCurrency(pdN)}</div>`;
            document.getElementById('pd_event_title').innerText = "Retirement";
            document.getElementById('pd_event_desc').innerText = "You survived the market cycles.";
        } else {
            nextYearScenario();
        }
    }
    function resetPD() { pdN=1000000; pdY=1; document.getElementById('pd_networth').innerText=formatCurrency(pdN); document.getElementById('pd_year').innerText="Year 1"; document.getElementById('pd_buttons').innerHTML=`<button class="kid-btn btn-need" onclick="pdResolve('invest')">Invest</button><button class="kid-btn btn-want" onclick="pdResolve('hold')">Hold</button>`; document.getElementById('pd_feedback').innerText=""; nextYearScenario(); }

    // --- GAME 3: WEALTH RUN ---
    let runGameInterval, spawnInterval, runLane=1, runIsJumping=false, runScore=0, runSpeed=5, runActive=false;
    const lanes = [15, 50, 85]; const avatars = ['üèéÔ∏è', 'üèçÔ∏è'];
    function startRunGame() {
        if(runActive) return;
        runActive=true; runScore=0; runSpeed=3.5;
        document.getElementById('run_score').innerText=0; document.getElementById('run_start_overlay').style.display='none'; document.getElementById('run_game_over').style.display='none'; document.querySelectorAll('.obstacle, .coin').forEach(e=>e.remove());
        const p=document.getElementById('run_player'); p.innerText=avatars[Math.floor(Math.random()*avatars.length)]; runLane=1; p.style.left=lanes[1]+'%'; p.className="player-ball";
        runGameInterval=requestAnimationFrame(gameLoopRun); spawnInterval=setInterval(spawnObject, 600);
    }
    function moveRun(dir) {
        if(!runActive) return; const p=document.getElementById('run_player');
        if(dir==='left'&&runLane>0) { runLane--; p.className="player-ball lean-left"; setTimeout(()=>p.className="player-ball", 200); } 
        if(dir==='right'&&runLane<2) { runLane++; p.className="player-ball lean-right"; setTimeout(()=>p.className="player-ball", 200); }
        p.style.left=lanes[runLane]+'%';
        if(dir==='jump'&&!runIsJumping) { runIsJumping=true; p.style.bottom='120px'; p.style.transform='translateX(-50%) scale(1.5)'; setTimeout(()=>{p.style.bottom='20px'; p.style.transform='translateX(-50%) scale(1)'; runIsJumping=false;},500); }
    }
    function spawnObject() {
        if(!runActive) return;
        const type=Math.random()>0.4?'obstacle':'coin'; const laneIdx=Math.floor(Math.random()*3);
        const obj=document.createElement('div'); obj.classList.add(type); obj.style.top='25%'; obj.style.left=lanes[laneIdx]+'%'; obj.style.width='10px'; obj.style.height='10px'; obj.dataset.lane=laneIdx; obj.dataset.y=25;
        document.getElementById('run_game_container').appendChild(obj);
        function moveObj() {
            if(!runActive||!obj.parentNode)return;
            let y=parseFloat(obj.dataset.y); y+=runSpeed*0.5; obj.dataset.y=y;
            let progress=(y-25)/75; let scale=0.2+(progress*1.5);
            obj.style.top=y+'%'; obj.style.transform=`translateX(-50%) scale(${scale})`; obj.style.opacity=progress>0.1?1:progress*10;
            if(y>85&&y<95&&parseInt(obj.dataset.lane)===runLane) { if(type==='obstacle'&&!runIsJumping) gameOverRun(); else if(type==='coin'){runScore+=100;document.getElementById('run_score').innerText=runScore;obj.remove();} }
            if(y>110)obj.remove(); else requestAnimationFrame(moveObj);
        } requestAnimationFrame(moveObj);
    }
    function gameLoopRun() { if(runActive){runSpeed+=0.002; requestAnimationFrame(gameLoopRun);} }
    function gameOverRun() { runActive=false; clearInterval(spawnInterval); cancelAnimationFrame(runGameInterval); document.getElementById('run_game_over').style.display='flex'; }

    // --- KID 1: COIN QUEST ---
    let kqS=0, kqIdx=0; 
    const kqItems=[ {n:"Vegetables",i:"ü•¶",t:"need"},{n:"PS5",i:"üéÆ",t:"want"},{n:"School Fees",i:"üéí",t:"need"},{n:"Candy",i:"üç¨",t:"want"}, {n:"Medicine",i:"üíä",t:"need"},{n:"New Phone",i:"üì±",t:"want"},{n:"Water",i:"üíß",t:"need"},{n:"Designer Shoes",i:"üëü",t:"want"}, {n:"Electricity",i:"üí°",t:"need"},{n:"Ice Cream",i:"üç¶",t:"want"},{n:"Books",i:"üìö",t:"need"},{n:"Movie Ticket",i:"üéüÔ∏è",t:"want"}, {n:"Rent",i:"üè†",t:"need"},{n:"Jewelry",i:"üíç",t:"want"},{n:"Bus Ticket",i:"üöå",t:"need"} ];
    function checkKQ(c) {
        let item=kqItems[kqIdx];
        if(c===item.t) {kqS++; document.getElementById('kq_msg').innerText="‚úÖ Correct!"; document.getElementById('kq_msg').style.color='var(--success)';} 
        else {document.getElementById('kq_msg').innerText="‚ùå Oops!"; document.getElementById('kq_msg').style.color='var(--accent)';}
        kqIdx++; document.getElementById('kq_score').innerText=kqS;
        if(kqIdx >= kqItems.length) { setTimeout(showKQResult, 500); } else { setTimeout(loadKQ, 800); }
    }
    function loadKQ() { let i=kqItems[kqIdx]; document.getElementById('kq_icon').innerText=i.i; document.getElementById('kq_item').innerText=i.n; document.getElementById('kq_msg').innerText=""; }
    function showKQResult() {
        document.getElementById('kq_game_area').style.display = 'none'; document.getElementById('kq_result_area').style.display = 'block';
        let rank = ""; if(kqS >= 13) rank = "üåü Money Master üåü"; else if(kqS >= 8) rank = "üëç Smart Saver"; else rank = "üë∂ Learner";
        document.getElementById('kq_rank').innerText = rank; document.getElementById('kq_final_score').innerText = `You got ${kqS} out of 15 correct!`;
    }
    function resetKQ() { kqS=0; kqIdx=0; document.getElementById('kq_score').innerText=0; document.getElementById('kq_game_area').style.display='block'; document.getElementById('kq_result_area').style.display='none'; loadKQ(); }

    // --- KID 2: PIGGY DASH ---
    let pigInt, pigSpawnInt, pigPos=50, pigScore=0, pigActive=false, pigMoveDir=0;
    const pigGood = ['üí∞','ü™ô','üíµ','üíé','üè¶'];
    const pigBad = ['üî®','üí£','üßæ','üìâ'];
    function startPiggy() {
        if(pigActive) return;
        pigActive=true; pigScore=0; pigPos=50; document.getElementById('piggy_score').innerText="0";
        document.getElementById('piggy_overlay').style.display='none';
        document.querySelectorAll('.drop-item').forEach(e=>e.remove());
        updatePiggyPos();
        pigInt = requestAnimationFrame(loopPiggy);
        pigSpawnInt = setInterval(spawnPiggyItem, 600);
    }
    function movePiggy(dir) { pigMoveDir = dir === 'left' ? -2 : 2; }
    function stopPiggy() { pigMoveDir = 0; }
    function updatePiggyPos() { const p = document.getElementById('piggy_player'); p.style.left = pigPos + "%"; p.style.transform = 'translateX(-50%)'; }
    function spawnPiggyItem() {
        if(!pigActive) return;
        const type = Math.random() > 0.3 ? 'money' : 'bad';
        const el = document.createElement('div'); el.className = 'drop-item';
        if(type === 'money') el.innerText = pigGood[Math.floor(Math.random()*pigGood.length)];
        else el.innerText = pigBad[Math.floor(Math.random()*pigBad.length)];
        el.style.left = (Math.random() * 90 + 5) + "%"; el.style.top = "-50px"; el.dataset.y = -50; el.dataset.type = type;
        document.getElementById('piggy_container').appendChild(el);
    }
    function loopPiggy() {
        if(!pigActive) return;
        if(pigMoveDir !== 0) { pigPos += pigMoveDir; if(pigPos < 10) pigPos = 10; if(pigPos > 90) pigPos = 90; updatePiggyPos(); }
        document.querySelectorAll('.drop-item').forEach(item => {
            let y = parseFloat(item.dataset.y); y += 4; item.dataset.y = y; item.style.top = y + "px";
            if(y > 350 && y < 400) {
                let itemLeft = parseFloat(item.style.left);
                if(Math.abs(itemLeft - pigPos) < 15) {
                    if(item.dataset.type === 'money') { pigScore += 100; document.getElementById('piggy_score').innerText = pigScore; item.remove(); } 
                    else { pigActive = false; clearInterval(pigSpawnInt); document.getElementById('piggy_overlay').style.display = 'flex'; document.getElementById('piggy_overlay').innerHTML = `<h2>Ouch! Debt!</h2><p>Score: ‚Çπ${pigScore}</p><button class="kid-btn btn-need" onclick="startPiggy()">Try Again</button>`; }
                }
            }
            if(y > 460) item.remove();
        });
        requestAnimationFrame(loopPiggy);
    }

    setupInput('sip_amt'); setupInput('sip_years','years'); setupInput('sip_rate','percent');
    setupInput('emi_amt'); setupInput('emi_years','years'); setupInput('emi_rate','percent');
    setupInput('arb_amt'); setupInput('arb_loan_rate','percent'); setupInput('arb_inv_rate','percent');
    calcAll();
</script>
</body>
</html>
