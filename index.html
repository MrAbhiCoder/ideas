<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WealthVerse Nexus | Next-Gen Finance</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-glass: rgba(30, 41, 59, 0.7);
            --border-glass: rgba(255, 255, 255, 0.1);
            --primary: #3b82f6;
            --accent: #8b5cf6;
            --neon-green: #10b981;
            --neon-red: #ef4444;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
            --gradient-main: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            --gradient-gold: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; }
        
        body { 
            background-color: var(--bg-dark); 
            background-image: 
                radial-gradient(at 0% 0%, rgba(59, 130, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 0%, rgba(139, 92, 246, 0.15) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(16, 185, 129, 0.1) 0px, transparent 50%);
            color: var(--text-main); 
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            padding-bottom: 2rem;
        }

        /* --- Animations --- */
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-5px); } 100% { transform: translateY(0px); } }
        @keyframes glow { 0% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.2); } 50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.6); } 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.2); } }

        .container { max-width: 1280px; margin: 0 auto; padding: 1rem; }

        /* --- Header --- */
        header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 1.5rem 0; margin-bottom: 2rem; border-bottom: 1px solid var(--border-glass);
        }
        .brand { font-family: 'Space Grotesk', sans-serif; font-size: 1.8rem; font-weight: 700; background: var(--gradient-main); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: flex; align-items: center; gap: 10px; }
        .user-pill { background: rgba(255,255,255,0.05); padding: 5px 15px; border-radius: 20px; font-size: 0.9rem; display: flex; align-items: center; gap: 8px; border: 1px solid var(--border-glass); }

        /* --- Navigation --- */
        .nav-dock {
            display: flex; justify-content: center; gap: 1rem; margin-bottom: 2.5rem;
            background: rgba(15, 23, 42, 0.6); backdrop-filter: blur(10px);
            padding: 10px; border-radius: 20px; border: 1px solid var(--border-glass);
            width: fit-content; margin-left: auto; margin-right: auto;
            box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5);
        }
        .nav-btn {
            background: transparent; border: none; padding: 0.8rem 1.5rem; border-radius: 12px;
            color: var(--text-sub); cursor: pointer; font-weight: 600; font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); display: flex; align-items: center; gap: 8px;
        }
        .nav-btn i { font-size: 1.2rem; }
        .nav-btn:hover { color: white; background: rgba(255,255,255,0.05); }
        .nav-btn.active { 
            background: var(--gradient-main); color: white; 
            box-shadow: 0 4px 15px rgba(59, 130, 246, 0.4);
            transform: scale(1.05);
        }
        .nav-btn.game-mode.active { background: var(--gradient-gold); box-shadow: 0 4px 15px rgba(245, 158, 11, 0.4); }

        /* --- Layout --- */
        .dashboard { display: none; grid-template-columns: 350px 1fr; gap: 2rem; animation: fadeIn 0.4s ease-out; }
        .dashboard.active { display: grid; }
        .game-layout { display: none; grid-template-columns: 1fr 300px; gap: 2rem; animation: fadeIn 0.4s ease-out; }
        .game-layout.active { display: grid; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Cards --- */
        .glass-card {
            background: var(--card-glass); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--border-glass); border-radius: 24px; padding: 2rem;
            box-shadow: 0 20px 40px -5px rgba(0,0,0,0.3); position: relative; overflow: hidden;
        }
        .glass-card::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
        }

        /* --- Inputs --- */
        .control-group { margin-bottom: 2rem; }
        .label-row { display: flex; justify-content: space-between; margin-bottom: 0.8rem; align-items: center; }
        .label-row label { font-size: 0.9rem; font-weight: 500; color: var(--text-sub); }
        .edit-pill { 
            background: rgba(0,0,0,0.3); border: 1px solid var(--border-glass); 
            color: var(--primary); font-weight: 700; padding: 4px 10px; border-radius: 8px; font-size: 0.9rem;
            width: 100px; text-align: right; transition: all 0.2s;
        }
        .edit-pill:focus { border-color: var(--primary); box-shadow: 0 0 0 2px rgba(59,130,246,0.2); }

        /* Slider Styling */
        input[type=range] {
            -webkit-appearance: none; width: 100%; background: transparent; cursor: pointer;
        }
        input[type=range]::-webkit-slider-runnable-track {
            width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px;
        }
        input[type=range]::-webkit-slider-thumb {
            -webkit-appearance: none; height: 20px; width: 20px; border-radius: 50%;
            background: var(--text-main); margin-top: -7px; box-shadow: 0 0 10px rgba(255,255,255,0.5);
            transition: transform 0.1s;
        }
        input[type=range]:active::-webkit-slider-thumb { transform: scale(1.3); background: var(--primary); }

        /* --- Stats & Charts --- */
        .big-result { font-family: 'Space Grotesk', sans-serif; font-size: 3.5rem; font-weight: 700; line-height: 1; margin-bottom: 0.5rem; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .sub-result { color: var(--text-sub); font-size: 1rem; margin-bottom: 2rem; display: flex; align-items: center; gap: 5px; }
        
        .stats-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 1rem; margin-bottom: 1.5rem; }
        .stat-box { background: rgba(255,255,255,0.03); padding: 1rem; border-radius: 16px; text-align: center; border: 1px solid var(--border-glass); }
        .stat-box h4 { font-size: 0.75rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-sub); margin-bottom: 5px; }
        .stat-box p { font-size: 1.2rem; font-weight: 600; }

        .chart-container { position: relative; height: 350px; width: 100%; margin-top: 2rem; }

        /* --- GAME MODE STYLES --- */
        .game-screen { background: #000; border: 1px solid #333; height: 400px; border-radius: 16px; position: relative; overflow: hidden; }
        .game-ui { position: absolute; top: 10px; left: 10px; right: 10px; display: flex; justify-content: space-between; z-index: 10; pointer-events: none; }
        .game-stat { background: rgba(0,0,0,0.7); padding: 5px 10px; border-radius: 8px; color: #fff; font-family: monospace; font-size: 1.1rem; border: 1px solid #444; }
        .game-controls { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 1rem; }
        .game-btn { 
            padding: 1.5rem; border: none; border-radius: 12px; font-weight: 800; font-size: 1.2rem; cursor: pointer; text-transform: uppercase;
            transition: transform 0.1s;
        }
        .btn-buy { background: var(--neon-green); color: #000; box-shadow: 0 0 15px rgba(16, 185, 129, 0.4); }
        .btn-sell { background: var(--neon-red); color: #fff; box-shadow: 0 0 15px rgba(239, 68, 68, 0.4); }
        .game-btn:active { transform: scale(0.95); }
        .log-feed { height: 200px; overflow-y: auto; font-family: monospace; font-size: 0.8rem; color: var(--text-sub); margin-top: 1rem; border-top: 1px solid #333; padding-top: 10px; }
        .log-item { margin-bottom: 4px; border-bottom: 1px solid rgba(255,255,255,0.05); padding-bottom: 2px;}

        /* Mobile */
        @media (max-width: 900px) { 
            .dashboard, .game-layout { grid-template-columns: 1fr; } 
            .nav-dock { flex-wrap: wrap; width: 100%; border-radius: 12px; }
            .big-result { font-size: 2.5rem; }
        }
    </style>
</head>
<body>

<div class="container">
    <header>
        <div class="brand"><i class="ph-fill ph-planet"></i> WealthVerse Nexus</div>
        <div class="user-pill"><i class="ph ph-user-circle"></i> Guest User</div>
    </header>

    <nav class="nav-dock">
        <button class="nav-btn active" onclick="switchTab('sip')"><i class="ph ph-plant"></i> Wealth Builder</button>
        <button class="nav-btn" onclick="switchTab('emi')"><i class="ph ph-house-line"></i> Debt Destroyer</button>
        <button class="nav-btn" onclick="switchTab('swp')"><i class="ph ph-armchair"></i> Freedom Flow</button>
        <button class="nav-btn" onclick="switchTab('arb')"><i class="ph ph-scales"></i> Arb Hunter</button>
        <button class="nav-btn game-mode" onclick="switchTab('game')"><i class="ph-fill ph-game-controller"></i> Market Master</button>
    </nav>

    <div id="sip" class="dashboard active">
        <div class="glass-card">
            <h3 style="margin-bottom: 1.5rem; display:flex; align-items:center; gap:10px;"><i class="ph ph-sliders-horizontal"></i> Configuration</h3>
            
            <div class="control-group">
                <div class="label-row"><label>Monthly Investment</label><input type="text" class="edit-pill" id="sip_amt_txt"></div>
                <input type="range" id="sip_amt" min="500" max="200000" step="500" value="10000">
            </div>
            
            <div class="control-group">
                <div class="label-row"><label>Time Period</label><input type="text" class="edit-pill" id="sip_years_txt"></div>
                <input type="range" id="sip_years" min="1" max="40" step="1" value="15">
            </div>
            
            <div class="control-group">
                <div class="label-row"><label>Expected Return (CAGR)</label><input type="text" class="edit-pill" id="sip_rate_txt"></div>
                <input type="range" id="sip_rate" min="5" max="30" step="0.5" value="12">
            </div>

            <div class="control-group" style="background: rgba(16, 185, 129, 0.1); padding: 15px; border-radius: 12px; border:1px solid rgba(16, 185, 129, 0.3);">
                <div class="label-row"><label style="color:var(--neon-green)">Annual Step-Up (Boost)</label><input type="text" class="edit-pill" id="sip_step_txt" style="color:var(--neon-green); border-color: var(--neon-green);"></div>
                <input type="range" id="sip_step" min="0" max="50" step="1" value="10">
            </div>
        </div>

        <div class="glass-card">
            <div class="sub-result">Projected Maturity Value <i class="ph-fill ph-info"></i></div>
            <div class="big-result" id="sip_total_val">₹ 0</div>
            
            <div class="stats-grid">
                <div class="stat-box"><h4>Invested</h4><p id="sip_invested_val">₹0</p></div>
                <div class="stat-box" style="border-color: rgba(16, 185, 129, 0.3);">
                    <h4>Pure Profit</h4><p id="sip_gains_val" style="color: var(--neon-green)">₹0</p>
                </div>
            </div>
            
            <div style="margin-bottom: 1rem; display: flex; justify-content: flex-end;">
                 <label style="font-size: 0.8rem; color: var(--text-sub); display: flex; align-items: center; gap: 5px; cursor: pointer;">
                    <input type="checkbox" id="inflation_toggle"> Adjust for Inflation (6%)
                 </label>
            </div>

            <div class="chart-container"><canvas id="sipChart"></canvas></div>
        </div>
    </div>

    <div id="game" class="game-layout">
        <div class="glass-card" style="display: flex; flex-direction: column;">
            <div style="display: flex; justify-content: space-between; margin-bottom: 1rem;">
                <h3><i class="ph-fill ph-trend-up"></i> Live Market</h3>
                <span id="game_timer" style="color: var(--text-sub);">Time: 0s</span>
            </div>
            <div class="game-screen">
                <div class="game-ui">
                    <div class="game-stat" style="background:rgba(0,0,0,0.8); color:var(--neon-green);">PRICE: $<span id="game_price">100.00</span></div>
                    <div class="game-stat" id="price_change">0.00%</div>
                </div>
                <canvas id="gameChart"></canvas>
            </div>
            <div style="margin-top: 1rem; color: var(--text-sub); font-size: 0.9rem; text-align: center;">
                Objective: Turn $10,000 into $1,000,000. Buy Low, Sell High. Market updates every 1s.
            </div>
        </div>

        <div class="glass-card">
            <h3 style="color: var(--text-main)">Portfolio</h3>
            <div style="margin-top: 1.5rem;">
                <div style="font-size: 0.8rem; color: var(--text-sub);">TOTAL EQUITY</div>
                <div style="font-size: 2rem; font-weight: 800; color: #fff;" id="game_equity">$10,000</div>
            </div>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 1rem;">
                <div class="stat-box"><h4>Cash</h4><p id="game_cash" style="font-size: 1rem;">$10,000</p></div>
                <div class="stat-box"><h4>Assets</h4><p id="game_assets" style="font-size: 1rem;">0</p></div>
            </div>

            <div class="game-controls">
                <button class="game-btn btn-buy" onclick="gameAction('buy')" id="btn_buy">BUY</button>
                <button class="game-btn btn-sell" onclick="gameAction('sell')" id="btn_sell">SELL</button>
            </div>

            <h4 style="margin-top: 1.5rem; font-size: 0.8rem; text-transform: uppercase; color: var(--text-sub);">Trade Log</h4>
            <div class="log-feed" id="game_log">
                <div class="log-item">System: Market Opened. Good Luck.</div>
            </div>
        </div>
    </div>
    
    <div id="emi" class="dashboard">
        <div class="glass-card">
            <h3><i class="ph ph-bank"></i> Loan Details</h3><br>
            <div class="control-group"><div class="label-row"><label>Loan Amount</label><input class="edit-pill" id="emi_amt_txt"></div><input type="range" id="emi_amt" min="100000" max="10000000" step="100000" value="5000000"></div>
            <div class="control-group"><div class="label-row"><label>Tenure (Years)</label><input class="edit-pill" id="emi_years_txt"></div><input type="range" id="emi_years" min="1" max="30" step="1" value="20"></div>
            <div class="control-group"><div class="label-row"><label>Interest Rate (%)</label><input class="edit-pill" id="emi_rate_txt"></div><input type="range" id="emi_rate" min="1" max="15" step="0.1" value="8.5"></div>
        </div>
        <div class="glass-card">
            <div class="sub-result">Monthly Commitment</div>
            <div class="big-result" id="emi_monthly_val" style="color: var(--neon-red); background: none; -webkit-text-fill-color: var(--neon-red);">₹ 0</div>
            <div class="stats-grid">
                <div class="stat-box"><h4>Total Interest</h4><p id="emi_interest_val" style="color:var(--neon-red)">₹0</p></div>
                <div class="stat-box"><h4>Total Payment</h4><p id="emi_total_val">₹0</p></div>
            </div>
            <div class="chart-container"><canvas id="emiChart"></canvas></div>
        </div>
    </div>

    <div id="swp" class="dashboard">
        <div class="glass-card">
            <h3><i class="ph ph-sun"></i> Retirement Plan</h3><br>
            <div class="control-group"><div class="label-row"><label>Total Corpus</label><input class="edit-pill" id="swp_corpus_txt"></div><input type="range" id="swp_corpus" min="500000" max="50000000" step="500000" value="10000000"></div>
            <div class="control-group"><div class="label-row"><label>Monthly Withdrawal</label><input class="edit-pill" id="swp_withdraw_txt"></div><input type="range" id="swp_withdraw" min="5000" max="200000" step="1000" value="50000"></div>
            <div class="control-group"><div class="label-row"><label>Growth Rate (%)</label><input class="edit-pill" id="swp_rate_txt"></div><input type="range" id="swp_rate" min="1" max="15" step="0.5" value="8"></div>
        </div>
        <div class="glass-card">
            <div class="sub-result">Final Balance (Yr 20)</div>
            <div class="big-result" id="swp_final_val">₹ 0</div>
            <div class="chart-container"><canvas id="swpChart"></canvas></div>
        </div>
    </div>

    <div id="arb" class="dashboard">
        <div class="glass-card">
            <h3><i class="ph ph-arrows-left-right"></i> Arbitrage Check</h3><br>
            <p style="color:var(--text-sub); font-size:0.8rem; margin-bottom:1rem;">Borrowing at low rate to invest at high rate.</p>
            <div class="control-group"><div class="label-row"><label>Loan Amount</label><input class="edit-pill" id="arb_amt_txt"></div><input type="range" id="arb_amt" min="500000" max="10000000" step="100000" value="5000000"></div>
            <div class="control-group"><div class="label-row"><label>Loan Cost (%)</label><input class="edit-pill" id="arb_loan_rate_txt"></div><input type="range" id="arb_loan_rate" min="1" max="15" step="0.1" value="7.5"></div>
            <div class="control-group"><div class="label-row"><label>Investment Return (%)</label><input class="edit-pill" id="arb_inv_rate_txt"></div><input type="range" id="arb_inv_rate" min="1" max="15" step="0.1" value="10"></div>
        </div>
        <div class="glass-card">
            <div class="sub-result">Net Profit / Loss</div>
            <div class="big-result" id="arb_net_val">₹ 0</div>
            <div style="font-size:1.2rem; font-weight:bold; text-align:center; margin-bottom:1rem;" id="arb_status"></div>
            <div class="chart-container"><canvas id="arbChart"></canvas></div>
        </div>
    </div>

</div>

<script>
    // --- UTILITIES ---
    const formatCurrency = (num) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);
    const formatUSD = (num) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD' }).format(num);
    const formatNum = (num) => new Intl.NumberFormat('en-IN').format(num);
    
    // Short format (1.5 Cr)
    function toWords(num) {
        if (num >= 10000000) return (num / 10000000).toFixed(2) + " Cr";
        if (num >= 100000) return (num / 100000).toFixed(2) + " L";
        if (num >= 1000) return (num / 1000).toFixed(1) + " K";
        return num;
    }

    let charts = {};
    let inflationAdjusted = false;

    // --- CHART CONFIG ---
    Chart.defaults.color = '#94a3b8';
    Chart.defaults.borderColor = 'rgba(255,255,255,0.1)';
    Chart.defaults.font.family = "'Space Grotesk', sans-serif";

    function getGradient(ctx, colorStart, colorEnd) {
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, colorStart);
        gradient.addColorStop(1, colorEnd);
        return gradient;
    }

    // --- INPUT SYNC ---
    function setupSync(id, isPercent=false, isYear=false) {
        const slider = document.getElementById(id);
        const text = document.getElementById(id + '_txt');

        function updateUI(val) {
            if(isPercent) text.value = val + "%";
            else if(isYear) text.value = val + " Yrs";
            else text.value = toWords(val);
        }

        slider.addEventListener('input', () => { updateUI(slider.value); calcAll(); });
        text.addEventListener('change', () => { /* Simple parse logic omitted for brevity in game mode focus */ });
        updateUI(slider.value);
    }

    // --- CALCULATION CORE ---
    function calcSIP() {
        let P = parseFloat(document.getElementById('sip_amt').value);
        let years = parseFloat(document.getElementById('sip_years').value);
        let rate = parseFloat(document.getElementById('sip_rate').value) / 100;
        let step = parseFloat(document.getElementById('sip_step').value) / 100;
        
        // Inflation logic
        const inflation = inflationAdjusted ? 0.06 : 0; 
        let realRate = (1 + rate) / (1 + inflation) - 1; // Real return formula

        let totalInv = 0, val = 0, monthlyRate = rate/12;
        let labels = [], dataVal = [];

        for(let y=1; y<=years; y++) {
            for(let m=1; m<=12; m++) {
                val = (val + P) * (1 + monthlyRate);
                totalInv += P;
            }
            let displayVal = inflationAdjusted ? val / Math.pow(1.06, y) : val;
            dataVal.push(displayVal);
            labels.push(y);
            P *= (1 + step);
        }

        const finalVal = dataVal[dataVal.length-1];
        document.getElementById('sip_total_val').innerText = formatCurrency(finalVal);
        document.getElementById('sip_invested_val').innerText = formatCurrency(totalInv);
        document.getElementById('sip_gains_val').innerText = formatCurrency(finalVal - totalInv);

        renderChart('sipChart', labels, dataVal, 'Wealth Growth', '#3b82f6', 'rgba(59, 130, 246, 0.2)');
    }

    function calcEMI() {
        const P = parseFloat(document.getElementById('emi_amt').value);
        const N = parseFloat(document.getElementById('emi_years').value) * 12;
        const R = parseFloat(document.getElementById('emi_rate').value) / 12 / 100;
        
        const emi = (P * R * Math.pow(1+R, N)) / (Math.pow(1+R, N) - 1);
        const total = emi * N;
        
        document.getElementById('emi_monthly_val').innerText = formatCurrency(emi);
        document.getElementById('emi_interest_val').innerText = formatCurrency(total - P);
        document.getElementById('emi_total_val').innerText = formatCurrency(total);

        // Simple Donut for EMI
        const ctx = document.getElementById('emiChart').getContext('2d');
        if(charts['emiChart']) charts['emiChart'].destroy();
        charts['emiChart'] = new Chart(ctx, {
            type: 'doughnut',
            data: {
                labels: ['Principal', 'Interest'],
                datasets: [{ data: [P, total-P], backgroundColor: ['#3b82f6', '#ef4444'], borderWidth: 0 }]
            },
            options: { cutout: '70%', plugins: { legend: { position: 'bottom' } } }
        });
    }

    function calcSWP() {
        // Simplified Logic for Demo
        let corpus = parseFloat(document.getElementById('swp_corpus').value);
        let withdraw = parseFloat(document.getElementById('swp_withdraw').value);
        let rate = parseFloat(document.getElementById('swp_rate').value)/100/12;
        let data = [], labels = [];
        
        for(let i=0; i<20; i++){
            for(let m=0; m<12; m++) corpus = (corpus*(1+rate)) - withdraw;
            data.push(corpus > 0 ? corpus : 0); labels.push(i+1);
        }
        document.getElementById('swp_final_val').innerText = formatCurrency(corpus > 0 ? corpus : 0);
        renderChart('swpChart', labels, data, 'Balance', '#10b981', 'rgba(16, 185, 129, 0.2)');
    }

    function calcArb() {
        let loan = parseFloat(document.getElementById('arb_amt').value);
        let cost = parseFloat(document.getElementById('arb_loan_rate').value)/100;
        let ret = parseFloat(document.getElementById('arb_inv_rate').value)/100;
        let profit = loan * (ret - cost) * 10; // 10 year simplified
        
        let el = document.getElementById('arb_net_val');
        el.innerText = formatCurrency(profit);
        el.style.color = profit > 0 ? 'var(--neon-green)' : 'var(--neon-red)';
        document.getElementById('arb_status').innerText = profit > 0 ? "✅ Money Glitch Active" : "❌ Wealth Trap Detected";
        document.getElementById('arb_status').style.color = profit > 0 ? 'var(--neon-green)' : 'var(--neon-red)';
    }

    function renderChart(id, labels, data, label, color, bg) {
        const ctx = document.getElementById(id).getContext('2d');
        if(charts[id]) charts[id].destroy();
        
        const gradient = ctx.createLinearGradient(0, 0, 0, 400);
        gradient.addColorStop(0, color);
        gradient.addColorStop(1, 'rgba(0,0,0,0)');

        charts[id] = new Chart(ctx, {
            type: 'line',
            data: { labels, datasets: [{ label, data, borderColor: color, backgroundColor: gradient, fill: true, tension: 0.4 }] },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { display: false } },
                scales: { x: { grid: { display: false } }, y: { grid: { color: 'rgba(255,255,255,0.05)' } } }
            }
        });
    }

    function calcAll() {
        if(document.getElementById('sip').classList.contains('active')) calcSIP();
        if(document.getElementById('emi').classList.contains('active')) calcEMI();
        if(document.getElementById('swp').classList.contains('active')) calcSWP();
        if(document.getElementById('arb').classList.contains('active')) calcArb();
    }

    // --- GAME ENGINE (Market Master) ---
    let gameInterval;
    let gameState = { cash: 10000, assets: 0, price: 100, time: 0, history: [] };
    let gameChart;

    function initGame() {
        const ctx = document.getElementById('gameChart').getContext('2d');
        // Setup initial empty chart
        let initialData = Array(50).fill(null); 
        initialData[49] = 100; // Start point

        gameChart = new Chart(ctx, {
            type: 'line',
            data: {
                labels: Array(50).fill(''),
                datasets: [{
                    data: initialData,
                    borderColor: '#fff',
                    borderWidth: 2,
                    pointRadius: 0,
                    tension: 0.1
                }]
            },
            options: {
                animation: false,
                responsive: true, maintainAspectRatio: false,
                scales: { x: { display: false }, y: { position: 'right', grid: { color: '#333' } } },
                plugins: { legend: { display: false } }
            }
        });

        if(gameInterval) clearInterval(gameInterval);
        gameInterval = setInterval(gameLoop, 1000);
    }

    function gameLoop() {
        if(!document.getElementById('game').classList.contains('active')) return;

        // Random Walk
        let volatility = 0.05; // 5% max swing
        let change = (Math.random() - 0.5) * 2 * volatility;
        gameState.price = gameState.price * (1 + change);
        gameState.time++;

        // Update UI
        document.getElementById('game_price').innerText = gameState.price.toFixed(2);
        document.getElementById('game_timer').innerText = "Time: " + gameState.time + "s";
        
        let changeEl = document.getElementById('price_change');
        changeEl.innerText = (change * 100).toFixed(2) + "%";
        changeEl.style.color = change >= 0 ? 'var(--neon-green)' : 'var(--neon-red)';

        updateTotalEquity();

        // Update Chart
        let data = gameChart.data.datasets[0].data;
        data.shift();
        data.push(gameState.price);
        gameChart.data.datasets[0].borderColor = change >= 0 ? '#10b981' : '#ef4444';
        gameChart.update();
    }

    function gameAction(type) {
        if(type === 'buy') {
            if(gameState.cash < gameState.price) return log("Not enough cash!");
            let amount = Math.floor(gameState.cash / gameState.price); // Buy max
            if(amount === 0) return; 
            gameState.cash -= amount * gameState.price;
            gameState.assets += amount;
            log(`BOUGHT ${amount} @ $${gameState.price.toFixed(2)}`);
        } else {
            if(gameState.assets <= 0) return log("No assets to sell!");
            let amount = gameState.assets; // Sell all
            gameState.cash += amount * gameState.price;
            gameState.assets = 0;
            log(`SOLD ${amount} @ $${gameState.price.toFixed(2)}`);
        }
        document.getElementById('game_cash').innerText = formatUSD(gameState.cash);
        document.getElementById('game_assets').innerText = gameState.assets;
        updateTotalEquity();
    }

    function updateTotalEquity() {
        let eq = gameState.cash + (gameState.assets * gameState.price);
        document.getElementById('game_equity').innerText = formatUSD(eq);
    }

    function log(msg) {
        const div = document.createElement('div');
        div.className = 'log-item';
        div.innerText = `[${gameState.time}s] ${msg}`;
        document.getElementById('game_log').prepend(div);
    }

    // --- NAVIGATION ---
    function switchTab(id) {
        document.querySelectorAll('.dashboard, .game-layout').forEach(d => d.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        
        if(id === 'game') {
            document.getElementById('game').classList.add('active');
            if(!gameChart) initGame();
        } else {
            document.getElementById(id).classList.add('active');
            setTimeout(calcAll, 50);
        }
        event.currentTarget.classList.add('active');
    }

    document.getElementById('inflation_toggle').addEventListener('change', (e) => {
        inflationAdjusted = e.target.checked;
        calcAll();
    });

    // --- INIT ---
    setupSync('sip_amt'); setupSync('sip_years', false, true); setupSync('sip_rate', true); setupSync('sip_step', true);
    setupSync('emi_amt'); setupSync('emi_years', false, true); setupSync('emi_rate', true);
    setupSync('swp_corpus'); setupSync('swp_withdraw'); setupSync('swp_rate', true);
    setupSync('arb_amt'); setupSync('arb_loan_rate', true); setupSync('arb_inv_rate', true);

    calcSIP(); // Initial Render
</script>

</body>
</html>
