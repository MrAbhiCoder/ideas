<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SIP Calculator with Annual Step Up</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
        }
        .container {
            width: 80%;
            margin: auto;
            overflow: hidden;
        }
        #main {
            background: #fff;
            padding: 20px;
            margin-top: 30px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h2 {
            color: #333;
        }
        input[type="number"], input[type="submit"] {
            width: 100%;
            padding: 10px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 5px;
        }
        input[type="submit"] {
            background-color: #28a745;
            color: white;
            border: none;
        }
        input[type="submit"]:hover {
            background-color: #218838;
        }
        .chart-container {
            display: flex;
            flex-direction: row; /* Align items in a row */
            flex-wrap: wrap; /* Allow items to wrap to the next line */
            gap: 20px;
        }
        .chart {
            width: 100%;
            max-width: 450px; /* Set a maximum width */
            /*margin: auto;  Center the chart */
            margin-left: 0; /* Align to the left */
        }
        .chart canvas {
            width: 100% !important;
            max-height: 400px !important; /* Set a maximum height */
            height: auto !important;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <div id="main">
            <h2>SIP Calculator with Annual Step Up</h2>
            <form id="sipForm">
                Monthly SIP Amount (INR): <input type="number" id="monthly_sip" value="50000" required><br>
                Investment Period (years): <input type="number" id="years" value="5" required><br>
                Expected Annual Return (%): <input type="number" step="0.01" id="annual_return" value="12" required><br>
                Annual Step Up (%): <input type="number" step="0.01" id="annual_step_up" value="0" required><br>
                <input type="submit" value="Calculate">
            </form>
            <div id="results" style="display:none;">
                <h3>Results:</h3>
                <p>Maturity Amount before Tax (INR): <span id="maturity_amount"></span></p>
                <p>Total Investment (INR): <span id="total_investment"></span></p>
                <p>Total Gain (INR): <span id="total_gain"></span></p>
                <p>Taxable Gain (INR): <span id="taxable_gain"></span></p>
                <p>LTCG Tax (INR): <span id="ltcg_tax"></span></p>
                <p>Maturity Amount after Tax (INR): <span id="post_tax_maturity_amount"></span></p>

                <div class="chart-container">
                    <div class="chart">
                        <h3>Break-up of Total Payment</h3>
                        <canvas id="paymentBreakupChart"></canvas>
                    </div>
                    <div class="chart">
                        <h3>SIP Schedule showing accumulated growth year-wise</h3>
                        <canvas id="sipScheduleChart"></canvas>
                    </div>
                    <div class="chart">
                        <h3>Accumulated Yearly SIP Contributions</h3>
                        <canvas id="yearlySipChart"></canvas>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        let paymentBreakupChart, sipScheduleChart, yearlySipChart;

        document.getElementById('sipForm').addEventListener('submit', function(event) {
            event.preventDefault();

            let monthly_sip = parseFloat(document.getElementById('monthly_sip').value);
            const years = parseInt(document.getElementById('years').value);
            const annual_return = parseFloat(document.getElementById('annual_return').value) / 100;
            const annual_step_up = parseFloat(document.getElementById('annual_step_up').value) / 100;

            const total_months = years * 12;
            const monthly_rate = annual_return / 12;

            let maturity_amount = 0;
            let sip_schedule = [];
            let yearly_sip_contributions = [];
            let total_investment = 0;
            let cumulative_investment = 0;
            let cumulative_investments = [];
            
            for (let year = 1; year <= years; year++) {
                let yearly_investment = 0;
                for (let month = 1; month <= 12; month++) {
                    maturity_amount += monthly_sip * Math.pow((1 + monthly_rate), (total_months - ((year - 1) * 12 + month)));
                    total_investment += monthly_sip;
                    yearly_investment += monthly_sip;
                }
                sip_schedule.push(maturity_amount);
                cumulative_investment += yearly_investment;
                cumulative_investments.push(cumulative_investment);
                yearly_sip_contributions.push(yearly_investment);
                monthly_sip *= (1 + annual_step_up);
            }

            const total_gain = maturity_amount - total_investment;
            const taxable_gain = total_gain - 100000;
            const ltcg_tax = taxable_gain > 0 ? taxable_gain * 0.10 : 0;
            const post_tax_maturity_amount = maturity_amount - ltcg_tax;

            document.getElementById('maturity_amount').textContent = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(maturity_amount);
            document.getElementById('total_investment').textContent = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(total_investment);
            document.getElementById('total_gain').textContent = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(total_gain);
            document.getElementById('taxable_gain').textContent = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(taxable_gain);
            document.getElementById('ltcg_tax').textContent = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(ltcg_tax);
            document.getElementById('post_tax_maturity_amount').textContent = new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(post_tax_maturity_amount);

            const paymentBreakupData = {
                labels: ['Total Investment', 'Total Gain', 'LTCG Tax'],
                datasets: [{
                    data: [total_investment, total_gain, ltcg_tax],
                    backgroundColor: ['#ff9999', '#66b3ff', '#ffcc99']
                }]
            };

            const sipScheduleData = {
                labels: Array.from({ length: years }, (_, i) => i + 1),
                datasets: [{
                    label: 'Accumulated Amount (INR)',
                    data: sip_schedule,
                    borderColor: '#66b3ff',
                    fill: false,
                    tension: 0.1
                }]
            };

            const yearlySipData = {
                labels: Array.from({ length: years }, (_, i) => i + 1),
                datasets: [{
                    label: 'Yearly SIP Contributions (INR)',
                    data: yearly_sip_contributions,
                    borderColor: '#ff9999',
                    fill: false,
                    tension: 0.1
                }]
            };

            if (paymentBreakupChart) {
                paymentBreakupChart.data = paymentBreakupData;
                paymentBreakupChart.update();
            } else {
                paymentBreakupChart = new Chart(document.getElementById('paymentBreakupChart'), {
                    type: 'pie',
                    data: paymentBreakupData,
                    options: {
                        responsive: true,
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed !== null) {
                                            label += new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(context.parsed);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            if (sipScheduleChart) {
                sipScheduleChart.data = sipScheduleData;
                sipScheduleChart.options.plugins.tooltip.callbacks.label = function(context) {
                    let labels = [];
                    if (context.dataIndex !== null) {
                        labels.push('Amount Invested: ' + new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(cumulative_investments[context.dataIndex]));
                    }
                    if (context.parsed.y !== null) {
                        labels.push('Accumulated Amount: ' + new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(context.parsed.y));
                    }
                    return labels;
                };
                sipScheduleChart.update();
            } else {
                sipScheduleChart = new Chart(document.getElementById('sipScheduleChart'), {
                    type: 'line',
                    data: sipScheduleData,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(value);
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let labels = [];
                                        if (context.dataIndex !== null) {
                                            labels.push('Amount Invested: ' + new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(cumulative_investments[context.dataIndex]));
                                        }
                                        if (context.parsed.y !== null) {
                                            labels.push('Accumulated Amount: ' + new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(context.parsed.y));
                                        }
                                        return labels;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            if (yearlySipChart) {
                yearlySipChart.data = yearlySipData;
                yearlySipChart.update();
            } else {
                yearlySipChart = new Chart(document.getElementById('yearlySipChart'), {
                    type: 'line',
                    data: yearlySipData,
                    options: {
                        responsive: true,
                        scales: {
                            y: {
                                ticks: {
                                    callback: function(value) {
                                        return new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(value);
                                    }
                                }
                            }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    label: function(context) {
                                        let label = context.dataset.label || '';
                                        if (label) {
                                            label += ': ';
                                        }
                                        if (context.parsed.y !== null) {
                                            label += new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR' }).format(context.parsed.y);
                                        }
                                        return label;
                                    }
                                }
                            }
                        }
                    }
                });
            }

            document.getElementById('results').style.display = 'block';
        });
    </script>
</body>
</html>
