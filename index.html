<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CalcIndiaPlayLearn</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;800&family=Space+Grotesk:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #0f172a;
            --card-glass: rgba(15, 23, 42, 0.95);
            --border-glass: rgba(255, 255, 255, 0.1);
            --primary: #6366f1;
            --accent: #f43f5e;
            --success: #10b981;
            --gold: #f59e0b;
            --neon-blue: #00f3ff;
            --neon-pink: #d946ef;
            --text-main: #f8fafc;
            --text-sub: #94a3b8;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; user-select: none; -webkit-tap-highlight-color: transparent; }
        
        body { 
            background-color: var(--bg-dark);
            color: var(--text-main); 
            font-family: 'Outfit', sans-serif;
            min-height: 100vh;
            padding-bottom: 3rem;
            overflow-x: hidden;
            transition: background 0.3s ease;
        }

        /* BACKGROUND MODES */
        body.mode-default { background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%); }
        body.mode-trader { background: radial-gradient(circle at center, #1e1b4b 0%, #020617 100%); }
        body.mode-run { background: linear-gradient(to bottom, #2e1065 0%, #0f172a 100%); }
        body.mode-kids { background: linear-gradient(120deg, #0ea5e9 0%, #8b5cf6 100%); }

        .container { max-width: 1200px; margin: 0 auto; padding: 1rem; }

        header { display: flex; justify-content: space-between; align-items: center; padding: 1.5rem 0; margin-bottom: 1.5rem; border-bottom: 1px solid var(--border-glass); }
        .brand { font-family: 'Space Grotesk', sans-serif; font-size: 1.8rem; font-weight: 700; background: linear-gradient(to right, #6366f1, #00f3ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent; display: flex; align-items: center; gap: 10px; }

        /* NAV SYSTEM */
        .nav-dock { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 10px; margin-bottom: 2rem; position: relative; z-index: 100; }
        .dropdown-container { position: relative; }
        .drop-trigger {
            width: 100%; padding: 12px; background: rgba(255,255,255,0.05); border: 1px solid var(--border-glass);
            border-radius: 12px; color: var(--text-sub); font-weight: 700; font-size: 0.9rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 8px; transition: all 0.3s;
        }
        .drop-trigger.active-cat { background: var(--primary); color: white; border-color: var(--primary); box-shadow: 0 0 15px rgba(99, 102, 241, 0.4); }
        .drop-menu {
            position: absolute; top: 115%; left: 0; width: 100%; min-width: 200px;
            background: rgba(15, 23, 42, 0.98); border: 1px solid var(--border-glass); border-radius: 16px; padding: 8px;
            display: none; flex-direction: column; gap: 5px; box-shadow: 0 10px 40px -10px rgba(0,0,0,0.5); z-index: 200;
        }
        .dropdown-container:last-child .drop-menu { right: 0; left: auto; }
        .show-menu { display: flex; animation: dropIn 0.2s ease-out; }
        @keyframes dropIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        .menu-btn {
            background: transparent; border: none; padding: 12px; color: var(--text-sub); text-align: left;
            font-size: 0.95rem; font-weight: 600; cursor: pointer; border-radius: 8px; display: flex; align-items: center; gap: 10px; transition: 0.2s;
        }
        .menu-btn:hover { background: rgba(255,255,255,0.05); color: white; padding-left: 15px; }
        .menu-btn.active { background: rgba(99, 102, 241, 0.2); color: var(--primary); border: 1px solid rgba(99, 102, 241, 0.3); }

        /* VIEW CONTAINERS (Crucial for Switching) */
        .app-view { display: none; opacity: 0; transition: opacity 0.2s ease-in; }
        .app-view.active-view { display: grid; opacity: 1; }
        
        .tool-layout { grid-template-columns: 1fr 1.5fr; gap: 1.5rem; }
        .game-layout { grid-template-columns: 1fr 350px; gap: 1.5rem; }
        .kid-layout { grid-template-columns: 1fr; gap: 1.5rem; max-width: 800px; margin: 0 auto; }

        /* UI ELEMENTS */
        .glass-card { background: var(--card-glass); backdrop-filter: blur(20px); border: 1px solid var(--border-glass); border-radius: 20px; padding: 2rem; box-shadow: 0 10px 30px -10px rgba(0,0,0,0.5); }
        .input-wrap { margin-bottom: 1.5rem; }
        .input-header { display: flex; justify-content: space-between; margin-bottom: 0.5rem; color: var(--text-sub); font-size: 0.9rem; }
        .input-val { font-weight: 700; color: var(--primary); }
        input[type=range] { width: 100%; height: 6px; background: rgba(255,255,255,0.1); border-radius: 10px; -webkit-appearance: none; cursor: pointer; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; height: 18px; width: 18px; border-radius: 50%; background: #fff; margin-top: -6px; }
        .big-value { font-size: 3rem; font-weight: 800; background: linear-gradient(to right, #fff, #cbd5e1); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .chart-container { position: relative; height: 280px; width: 100%; }

        .game-screen { background: #000; height: 400px; border-radius: 16px; position: relative; border: 1px solid #333; overflow: hidden; display:flex; flex-direction:column; justify-content:center; align-items:center; }
        .game-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: rgba(0,0,0,0.9); z-index: 20; display:none; flex-direction: column; justify-content: center; align-items: center; text-align: center; color: white; }
        
        .reset-btn { background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); color: #fca5a5; padding: 5px 12px; border-radius: 8px; font-size: 0.8rem; cursor: pointer; }
        .kid-btn { padding: 15px; border-radius: 12px; border: none; font-size: 1.1rem; font-weight: 800; cursor: pointer; width: 48%; margin: 5px; }
        .btn-need { background: var(--success); color: white; }
        .btn-want { background: var(--accent); color: white; }

        /* WEALTH RUN */
        #run_game_container { width: 100%; height: 100%; position: relative; background: linear-gradient(to bottom, #1e1b4b 0%, #4c1d95 50%, #db2777 100%); perspective: 600px; overflow: hidden; }
        .road { position: absolute; bottom: 0; left: 50%; transform: translateX(-50%) rotateX(60deg); width: 340px; height: 120%; background: #0f172a; border-left: 8px solid var(--neon-blue); border-right: 8px solid var(--neon-blue); box-shadow: 0 0 40px rgba(0, 243, 255, 0.3); }
        .lane-marker { position: absolute; top: 0; left: 33%; width: 4px; height: 100%; background: rgba(255,255,255,0.2); }
        .lane-marker.right { left: 66%; }
        .player-ball { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); font-size: 3.5rem; line-height: 1; z-index: 10; transition: left 0.05s ease-out; }
        .obstacle, .coin { position: absolute; transform: translateX(-50%); display: flex; justify-content: center; align-items: center; z-index: 5; }
        .obstacle { background: #111; border: 4px solid #ef4444; border-radius: 50%; width: 100%; height: 35px; box-shadow: inset 0 0 20px #000; }
        .coin { font-size: 0px; background: radial-gradient(circle, #fbbf24, #d97706); border: 4px solid #fff; border-radius: 50%; box-shadow: 0 0 25px #fbbf24; }
        .control-pad { display: flex; gap: 30px; margin-top: 15px; width: 100%; justify-content: center; }
        .control-btn { width: 70px; height: 70px; border-radius: 50%; background: rgba(255,255,255,0.1); color: white; font-size: 2rem; cursor: pointer; border: 1px solid rgba(255,255,255,0.3); display:flex; align-items:center; justify-content:center; }

        /* PIGGY */
        #piggy_container { width: 100%; height: 450px; position: relative; background: #1e293b; overflow: hidden; border: 3px solid var(--neon-pink); border-radius: 16px; }
        .piggy { position: absolute; bottom: 20px; width: 80px; height: 80px; background: #ec4899; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 3rem; border: 3px solid white; z-index: 10; transition: left 0.1s; }
        .drop-item { position: absolute; font-size: 3rem; transition: top 0.05s linear; }

        @media (max-width: 900px) { .app-view.active-view { grid-template-columns: 1fr; } }
    </style>
</head>
<body class="mode-default">

<div class="container">
    <header>
        <div class="brand"><i class="ph-fill ph-currency-inr"></i> WealthVerse <span style="font-weight:300; color:white;">Arcade</span></div>
    </header>

    <nav class="nav-dock">
        <div class="dropdown-container">
            <button class="drop-trigger active-cat" onclick="toggleMenu('menu-tools', this)"><i class="ph-fill ph-wrench"></i> Tools <i class="ph-bold ph-caret-down"></i></button>
            <div id="menu-tools" class="drop-menu">
                <button class="menu-btn active" onclick="switchTab('sip', this, 'tools')"><i class="ph-bold ph-trend-up"></i> SIP Calculator</button>
                <button class="menu-btn" onclick="switchTab('emi', this, 'tools')"><i class="ph-bold ph-house"></i> EMI Calculator</button>
                <button class="menu-btn" onclick="switchTab('arb', this, 'tools')"><i class="ph-bold ph-scales"></i> Arbitrage</button>
            </div>
        </div>
        <div class="dropdown-container">
            <button class="drop-trigger" onclick="toggleMenu('menu-arcade', this)"><i class="ph-fill ph-game-controller"></i> Arcade <i class="ph-bold ph-caret-down"></i></button>
            <div id="menu-arcade" class="drop-menu">
                <button class="menu-btn" onclick="switchTab('game1', this, 'arcade')"><i class="ph-fill ph-chart-candlestick"></i> Trader Pro</button>
                <button class="menu-btn" onclick="switchTab('game2', this, 'arcade')"><i class="ph-fill ph-shield-check"></i> Defense</button>
                <button class="menu-btn" onclick="switchTab('game3', this, 'arcade')"><i class="ph-fill ph-person-simple-run"></i> Wealth Run</button>
            </div>
        </div>
        <div class="dropdown-container">
            <button class="drop-trigger" onclick="toggleMenu('menu-kids', this)"><i class="ph-fill ph-baby"></i> Kids <i class="ph-bold ph-caret-down"></i></button>
            <div id="menu-kids" class="drop-menu">
                <button class="menu-btn" onclick="switchTab('kid1', this, 'kids')"><i class="ph-fill ph-coins"></i> Coin Quest</button>
                <button class="menu-btn" onclick="switchTab('kid2', this, 'kids')"><i class="ph-fill ph-piggy-bank"></i> Piggy Dash</button>
            </div>
        </div>
    </nav>

    <div id="sip" class="app-view tool-layout active-view">
        <div class="glass-card">
            <h3><i class="ph ph-sliders"></i> SIP Calculator</h3><br>
            <div class="input-wrap"><div class="input-header"><label>Monthly</label><span class="input-val" id="sip_amt_val">‚Çπ 25 K</span></div><input type="range" id="sip_amt" min="1000" max="200000" step="500" value="25000"></div>
            <div class="input-wrap"><div class="input-header"><label>Years</label><span class="input-val" id="sip_years_val">10 Yrs</span></div><input type="range" id="sip_years" min="1" max="40" step="1" value="10"></div>
            <div class="input-wrap"><div class="input-header"><label>Return</label><span class="input-val" id="sip_rate_val">12 %</span></div><input type="range" id="sip_rate" min="5" max="30" step="0.5" value="12"></div>
        </div>
        <div class="glass-card">
            <div class="big-number-block"><div class="input-header">Future Value</div><div class="big-value" id="sip_final">‚Çπ 0</div></div>
            <div class="chart-container"><canvas id="sipLineChart"></canvas></div>
        </div>
    </div>

    <div id="emi" class="app-view tool-layout">
        <div class="glass-card">
            <h3><i class="ph ph-house"></i> EMI Calculator</h3><br>
            <div class="input-wrap"><div class="input-header"><label>Loan</label><span class="input-val" id="emi_amt_val">‚Çπ 50 L</span></div><input type="range" id="emi_amt" min="500000" max="10000000" step="100000" value="5000000"></div>
            <div class="input-wrap"><div class="input-header"><label>Years</label><span class="input-val" id="emi_years_val">20 Yrs</span></div><input type="range" id="emi_years" min="1" max="30" step="1" value="20"></div>
            <div class="input-wrap"><div class="input-header"><label>Rate</label><span class="input-val" id="emi_rate_val">8.5 %</span></div><input type="range" id="emi_rate" min="6" max="15" step="0.1" value="8.5"></div>
        </div>
        <div class="glass-card">
            <div class="big-number-block"><div class="input-header">Monthly EMI</div><div class="big-value" id="emi_monthly">‚Çπ 0</div></div>
            <div class="chart-container"><canvas id="emiChart"></canvas></div>
        </div>
    </div>

    <div id="arb" class="app-view tool-layout">
        <div class="glass-card">
            <h3><i class="ph ph-scales"></i> Arbitrage</h3><br>
            <div class="input-wrap"><div class="input-header"><label>Loan</label><span class="input-val" id="arb_amt_val">‚Çπ 50 L</span></div><input type="range" id="arb_amt" min="500000" max="10000000" step="100000" value="5000000"></div>
            <div class="input-wrap"><div class="input-header"><label>Loan Rate</label><span class="input-val" id="arb_loan_rate_val">8 %</span></div><input type="range" id="arb_loan_rate" min="1" max="15" step="0.1" value="8"></div>
            <div class="input-wrap"><div class="input-header"><label>Inv Return</label><span class="input-val" id="arb_inv_rate_val">12 %</span></div><input type="range" id="arb_inv_rate" min="1" max="20" step="0.1" value="12"></div>
        </div>
        <div class="glass-card">
            <div class="big-number-block"><div class="input-header">Net Profit</div><div class="big-value" id="arb_net">‚Çπ 0</div><div id="arb_status" style="font-weight:700"></div></div>
            <div class="chart-container"><canvas id="arbChart"></canvas></div>
        </div>
    </div>

    <div id="game1" class="app-view game-layout">
        <div class="glass-card">
            <div style="display:flex;justify-content:space-between;align-items:center;"><h3>Live Market</h3><button class="reset-btn" onclick="resetMM()">Restart</button></div>
            <div class="game-screen">
                <div style="position:absolute;top:10px;left:10px;color:var(--success);font-size:1.2rem;">NIFTY: <span id="mm_price">20000</span></div>
                <div style="position:absolute;bottom:10px;left:10px;color:var(--gold);" id="mm_pattern">Scanning...</div>
                <canvas id="mmChart"></canvas>
            </div>
            <div style="margin-top:15px;display:flex;gap:10px;"><button class="kid-btn btn-need" onclick="mmTrade('buy')">BUY</button><button class="kid-btn btn-want" onclick="mmTrade('sell')">SELL</button></div>
        </div>
        <div class="glass-card"><h4>Portfolio</h4><div class="big-value" id="mm_equity">‚Çπ 10.0 L</div><div style="color:var(--text-sub)">Cash: <span id="mm_cash">‚Çπ 10.0 L</span></div></div>
    </div>

    <div id="game2" class="app-view game-layout">
        <div class="glass-card">
            <div style="display:flex;justify-content:space-between;align-items:center;"><h3>Defense</h3><button class="reset-btn" onclick="resetPD()">Restart</button></div>
            <div class="defense-card">
                <h2 id="pd_year" style="color:var(--primary)">Year 1</h2>
                <h3 id="pd_event">Market Stable</h3>
                <div id="pd_buttons" style="display:flex;gap:10px;justify-content:center;margin-top:20px;">
                    <button class="kid-btn btn-need" onclick="pdResolve('invest')">Invest</button><button class="kid-btn btn-want" onclick="pdResolve('hold')">Hold</button>
                </div>
            </div>
        </div>
        <div class="glass-card"><h4>Net Worth</h4><div class="big-value" id="pd_networth">‚Çπ 10.0 L</div><div id="pd_fb" style="margin-top:10px;font-weight:bold;color:var(--gold)"></div></div>
    </div>

    <div id="game3" class="app-view kid-layout">
        <div class="glass-card" style="border-color:var(--neon-blue);">
            <div style="display:flex;justify-content:space-between;"><h3>Wealth Run</h3><div style="font-weight:bold;color:var(--gold)">Score: <span id="run_score">0</span></div></div>
            <div class="game-screen" style="height:350px;margin-top:15px;border:2px solid #334155;">
                <div id="run_game_container">
                    <div class="road"><div class="lane-marker"></div><div class="lane-marker right"></div></div>
                    <div id="run_player" class="player-ball">üèéÔ∏è</div>
                    <div id="run_overlay" class="game-over-overlay"><h2>CRASHED!</h2><button class="kid-btn btn-need" onclick="startRunGame()">Try Again</button></div>
                    <div id="run_start" class="game-over-overlay" style="display:flex;"><h2>Ready?</h2><button class="kid-btn btn-need" onclick="startRunGame()">Start</button></div>
                </div>
            </div>
            <div class="control-pad"><button class="control-btn" onclick="moveRun('left')"><i class="ph-bold ph-arrow-left"></i></button><button class="control-btn" onclick="moveRun('jump')">UP</button><button class="control-btn" onclick="moveRun('right')"><i class="ph-bold ph-arrow-right"></i></button></div>
        </div>
    </div>

    <div id="kid1" class="app-view kid-layout">
        <div class="glass-card" style="border-color:var(--kid-blue);background:rgba(14,165,233,0.1);">
            <div style="display:flex;justify-content:space-between;"><h2>Coin Quest</h2><button class="reset-btn" onclick="resetKQ()">Reset</button></div>
            <div style="text-align:center;">
                <div style="font-size:1.2rem;margin:10px 0;">Score: <span id="kq_score">0</span></div>
                <div style="font-size:5rem;margin:20px 0;" id="kq_icon">üçé</div>
                <h3 id="kq_item" style="margin-bottom:20px;">Apple</h3>
                <div style="display:flex;gap:20px;justify-content:center;"><button class="kid-btn btn-need" onclick="checkKQ('need')">NEED</button><button class="kid-btn btn-want" onclick="checkKQ('want')">WANT</button></div>
                <div id="kq_msg" style="margin-top:15px;height:20px;"></div>
            </div>
        </div>
    </div>

    <div id="kid2" class="app-view kid-layout">
        <div class="glass-card" style="border-color:var(--neon-pink);background:rgba(236,72,153,0.1);">
            <div style="display:flex;justify-content:space-between;"><h2>Piggy Dash</h2><div style="color:var(--gold)">‚Çπ <span id="piggy_score">0</span></div></div>
            <div class="game-screen" id="piggy_container" style="margin-top:15px;border:2px solid var(--neon-pink);">
                <div id="piggy_player" class="piggy">üê∑</div>
                <div id="piggy_overlay" class="game-over-overlay" style="display:flex;"><h2>Catch Cash!</h2><button class="kid-btn btn-need" onclick="startPiggy()">Start</button></div>
            </div>
            <div class="control-pad"><button class="control-btn" onmousedown="movePiggy('left')" onmouseup="stopPiggy()" ontouchstart="movePiggy('left')" ontouchend="stopPiggy()"><i class="ph-bold ph-arrow-left"></i></button><button class="control-btn" onmousedown="movePiggy('right')" onmouseup="stopPiggy()" ontouchstart="movePiggy('right')" ontouchend="stopPiggy()"><i class="ph-bold ph-arrow-right"></i></button></div>
        </div>
    </div>

</div>

<script>
    const formatCurrency = (num) => new Intl.NumberFormat('en-IN', { style: 'currency', currency: 'INR', maximumFractionDigits: 0 }).format(num);
    let charts = {};

    // --- UNIVERSAL NAVIGATION ---
    function toggleMenu(menuId, btn) {
        // Close others
        document.querySelectorAll('.drop-menu').forEach(m => { if(m.id !== menuId) m.classList.remove('show-menu'); });
        document.getElementById(menuId).classList.toggle('show-menu');
    }

    function switchTab(targetId, btn, category) {
        // 1. UI Reset
        document.querySelectorAll('.drop-menu').forEach(m => m.classList.remove('show-menu'));
        document.querySelectorAll('.drop-trigger').forEach(b => b.classList.remove('active-cat'));
        btn.closest('.dropdown-container').querySelector('.drop-trigger').classList.add('active-cat');
        
        document.querySelectorAll('.menu-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');

        // 2. Hide All Views
        document.querySelectorAll('.app-view').forEach(v => {
            v.classList.remove('active-view');
            // Small timeout to allow css fade out before display:none (simplified here to instant switch for robustness)
            v.style.display = 'none'; 
        });

        // 3. Stop Games
        if(runActive) gameOverRun();
        if(pigActive) { pigActive=false; clearInterval(pigSpawnInt); cancelAnimationFrame(pigInt); }
        if(mmInt) { clearInterval(mmInt); mmInt=null; }

        // 4. Background Logic
        document.body.className = 'mode-default';
        if(category === 'arcade') {
            if(targetId === 'game1') document.body.classList.add('mode-trader');
            if(targetId === 'game3') document.body.classList.add('mode-run');
        } else if(category === 'kids') {
            document.body.classList.add('mode-kids');
        }

        // 5. Show Target View
        const targetView = document.getElementById(targetId);
        targetView.style.display = 'grid'; // Force layout
        
        // 6. Init Logic (Delayed slightly for Layout Paint)
        setTimeout(() => {
            targetView.classList.add('active-view');
            
            if(category === 'tools') {
                calcAll(); // Force redraw charts
            } else if(targetId === 'game1') {
                initMM();
            } else if(targetId === 'kid1') {
                loadKQ();
            }
        }, 10);
    }

    // --- CALCULATORS ---
    function setupInput(id) {
        document.getElementById(id).addEventListener('input', (e) => {
            let valId = id + '_val';
            let type = id.includes('rate') ? '%' : (id.includes('years') ? 'Yrs' : '');
            let val = parseFloat(e.target.value);
            document.getElementById(valId).innerText = type==='%' || type==='Yrs' ? val + " " + type : formatCurrency(val);
            calcAll();
        });
        // Init val
        let ev = new Event('input'); document.getElementById(id).dispatchEvent(ev);
    }

    function calcAll() {
        // SIP
        if(document.getElementById('sip').style.display !== 'none') {
            const P=parseFloat(document.getElementById('sip_amt').value), N=parseFloat(document.getElementById('sip_years').value), R=parseFloat(document.getElementById('sip_rate').value);
            let v=0, mR=R/1200; for(let i=0;i<N*12;i++) v=(v+P)*(1+mR);
            document.getElementById('sip_final').innerText = formatCurrency(v);
            drawChart('sipLineChart', 'line', Array.from({length:N},(_,i)=>i+1), Array.from({length:N},(_,i)=>{let t=0;for(let m=0;m<(i+1)*12;m++)t=(t+P)*(1+mR);return t}), '#6366f1');
        }
        // EMI
        if(document.getElementById('emi').style.display !== 'none') {
            const L=parseFloat(document.getElementById('emi_amt').value), Y=parseFloat(document.getElementById('emi_years').value)*12, I=parseFloat(document.getElementById('emi_rate').value)/1200;
            const emi=(L*I*Math.pow(1+I,Y))/(Math.pow(1+I,Y)-1);
            document.getElementById('emi_monthly').innerText=formatCurrency(emi);
            drawChart('emiChart', 'bar', ['Principal','Interest'], [L, (emi*Y)-L], '#6366f1');
        }
        // Arb
        if(document.getElementById('arb').style.display !== 'none') {
            const A=parseFloat(document.getElementById('arb_amt').value), lR=parseFloat(document.getElementById('arb_loan_rate').value)/100, iR=parseFloat(document.getElementById('arb_inv_rate').value)/100;
            let c=A, l=A, lbs=[], d1=[], d2=[];
            for(let i=1;i<=10;i++){c*=(1+iR); l*=(1+lR); lbs.push(i); d1.push(c); d2.push(l);}
            document.getElementById('arb_net').innerText=formatCurrency(c-l);
            document.getElementById('arb_status').innerText=(c-l)>0?"‚úÖ Profit":"‚ùå Loss";
            drawChart('arbChart', 'line', lbs, d1, '#10b981', d2);
        }
    }

    function drawChart(id, type, labels, data, color, data2=null) {
        const ctx = document.getElementById(id).getContext('2d');
        if(charts[id]) charts[id].destroy();
        let datasets = [{ label:'Value', data:data, borderColor:color, backgroundColor:color==='#6366f1'?'rgba(99,102,241,0.2)':color, fill:type==='line' }];
        if(data2) datasets.push({ label:'Loan', data:data2, borderColor:'#f43f5e', borderDash:[5,5], fill:false });
        
        charts[id] = new Chart(ctx, {
            type: type,
            data: { labels, datasets },
            options: { responsive:true, maintainAspectRatio:false, plugins:{legend:{display:false}}, scales:{x:{grid:{display:false}}, y:{grid:{color:'rgba(255,255,255,0.1)'}}} }
        });
    }

    // --- GAME 1: TRADER ---
    let mmInt, mmP=20000, mmC=1000000, mmS=0;
    function initMM() {
        if(charts['mm']) return;
        const ctx = document.getElementById('mmChart').getContext('2d');
        charts['mm'] = new Chart(ctx, { type:'bar', data:{labels:Array(30).fill(''),datasets:[{data:Array(30).fill(null),backgroundColor:'#94a3b8',barThickness:2},{data:Array(30).fill(null),backgroundColor:(c)=>c.raw&&c.raw[1]>=c.raw[0]?'#10b981':'#f43f5e',barThickness:8}]}, options:{animation:false,responsive:true,maintainAspectRatio:false,plugins:{legend:{display:false}},scales:{x:{display:false},y:{position:'right',grid:{color:'#333'}}}} });
        mmInt = setInterval(()=>{
            if(!document.getElementById('game1').classList.contains('active-view')) return;
            mmP += (Math.random()-0.5)*50; 
            document.getElementById('mm_price').innerText=mmP.toFixed(0);
            updateMM();
            let c=charts['mm']; c.data.datasets[0].data.shift(); c.data.datasets[0].data.push([mmP-20, mmP+20]); c.data.datasets[1].data.shift(); c.data.datasets[1].data.push([mmP, mmP+(Math.random()-0.5)*30]); c.update('none');
        }, 100);
    }
    function updateMM(){document.getElementById('mm_equity').innerText=formatCurrency(mmC+mmS*mmP);document.getElementById('mm_cash').innerText=formatCurrency(mmC);}
    function mmTrade(t){if(t==='buy'&&mmC>mmP){mmS++;mmC-=mmP;}if(t==='sell'&&mmS>0){mmS--;mmC+=mmP;}updateMM();}
    function resetMM(){mmC=1000000;mmS=0;mmP=20000;updateMM();}

    // --- GAME 2: DEFENSE ---
    let pdN=1000000, pdY=1; const pdScen=[{t:"Boom",val:1.2},{t:"Crash",val:0.8}];
    function pdResolve(c){if(pdY>10)return; let s=pdScen[Math.floor(Math.random()*2)]; pdN*=(c==='invest'?s.val:(s.val>1?1.05:0.98)); pdY++; document.getElementById('pd_networth').innerText=formatCurrency(pdN); document.getElementById('pd_feedback').innerText=s.t; if(pdY>10)document.getElementById('pd_event').innerText="Finished!";}
    function resetPD(){pdN=1000000;pdY=1;document.getElementById('pd_networth').innerText=formatCurrency(pdN);}

    // --- GAME 3: WEALTH RUN ---
    let runGameInterval, spawnInterval, runLane=1, runIsJumping=false, runScore=0, runActive=false;
    const lanes=[15,50,85];
    function startRunGame(){
        if(runActive)return; runActive=true; runScore=0; document.getElementById('run_score').innerText=0; document.getElementById('run_start').style.display='none'; document.getElementById('run_overlay').style.display='none'; document.querySelectorAll('.obstacle,.coin').forEach(e=>e.remove());
        runGameInterval=requestAnimationFrame(gameLoopRun); spawnInterval=setInterval(spawnObject,700);
    }
    function moveRun(d){if(!runActive)return; if(d==='left'&&runLane>0)runLane--; if(d==='right'&&runLane<2)runLane++; document.getElementById('run_player').style.left=lanes[runLane]+'%'; if(d==='jump'&&!runIsJumping){runIsJumping=true;document.getElementById('run_player').style.transform='translateX(-50%) scale(1.5)';setTimeout(()=>{document.getElementById('run_player').style.transform='translateX(-50%) scale(1)';runIsJumping=false;},500);}}
    function spawnObject(){
        if(!runActive)return; const type=Math.random()>0.4?'obstacle':'coin'; const l=Math.floor(Math.random()*3);
        const el=document.createElement('div'); el.className=type; el.style.top='25%'; el.style.left=lanes[l]+'%'; el.dataset.lane=l; el.dataset.y=25;
        document.getElementById('run_game_container').appendChild(el);
        function move(){
            if(!runActive||!el.parentNode)return; let y=parseFloat(el.dataset.y)+2; el.dataset.y=y;
            let s=0.2+((y-25)/75)*2; el.style.top=y+'%'; el.style.transform=`translateX(-50%) scale(${s})`;
            if(y>85&&y<95&&parseInt(el.dataset.lane)===runLane){
                if(type==='obstacle'&&!runIsJumping) gameOverRun();
                else if(type==='coin'){runScore+=100;document.getElementById('run_score').innerText=runScore;el.remove();}
            }
            if(y>110)el.remove(); else requestAnimationFrame(move);
        } requestAnimationFrame(move);
    }
    function gameLoopRun(){if(runActive)requestAnimationFrame(gameLoopRun);}
    function gameOverRun(){runActive=false;clearInterval(spawnInterval);cancelAnimationFrame(runGameInterval);document.getElementById('run_overlay').style.display='flex';}

    // --- KIDS ---
    let kqS=0, kqI=0; const kq=[{n:"Apple",t:"need",i:"üçé"},{n:"Toy",t:"want",i:"üß∏"}];
    function loadKQ(){let i=kq[kqI%2];document.getElementById('kq_icon').innerText=i.i;document.getElementById('kq_item').innerText=i.n;}
    function checkKQ(c){let i=kq[kqI%2]; if(c===i.t){kqS++;document.getElementById('kq_msg').innerText="Correct!";}else{document.getElementById('kq_msg').innerText="Wrong";} kqI++; document.getElementById('kq_score').innerText=kqS; setTimeout(loadKQ,500);}
    function resetKQ(){kqS=0;kqI=0;document.getElementById('kq_score').innerText=0;loadKQ();}

    let pigInt, pigSpawn, pigPos=50, pigSc=0, pigAct=false, pigDir=0;
    function startPiggy(){if(pigAct)return;pigAct=true;pigSc=0;pigPos=50;document.getElementById('piggy_overlay').style.display='none';document.querySelectorAll('.drop-item').forEach(e=>e.remove());pigInt=requestAnimationFrame(loopPig);pigSpawn=setInterval(spawnPig,600);}
    function movePiggy(d){pigDir=d==='left'?-2:2;} function stopPiggy(){pigDir=0;}
    function spawnPig(){if(!pigAct)return;const el=document.createElement('div');el.className='drop-item';el.innerText=Math.random()>0.3?'üí∞':'üî®';el.dataset.type=el.innerText==='üí∞'?'good':'bad';el.style.left=(Math.random()*90+5)+'%';el.style.top='-50px';el.dataset.y=-50;document.getElementById('piggy_container').appendChild(el);}
    function loopPig(){
        if(!pigAct)return; if(pigDir!==0){pigPos+=pigDir;if(pigPos<10)pigPos=10;if(pigPos>90)pigPos=90;document.getElementById('piggy_player').style.left=pigPos+'%';}
        document.querySelectorAll('.drop-item').forEach(e=>{
            let y=parseFloat(e.dataset.y)+4; e.dataset.y=y; e.style.top=y+'px';
            if(y>350&&y<400&&Math.abs(parseFloat(e.style.left)-pigPos)<15){
                if(e.dataset.type==='good'){pigSc+=100;document.getElementById('piggy_score').innerText=pigSc;e.remove();}
                else{pigAct=false;clearInterval(pigSpawn);document.getElementById('piggy_overlay').style.display='flex';}
            } if(y>460)e.remove();
        }); requestAnimationFrame(loopPig);
    }

    setupInput('sip_amt'); setupInput('sip_years'); setupInput('sip_rate');
    setupInput('emi_amt'); setupInput('emi_years'); setupInput('emi_rate');
    setupInput('arb_amt'); setupInput('arb_loan_rate'); setupInput('arb_inv_rate');
    calcAll();
</script>
</body>
</html>
